---
sudo: required
language: generic
dist: xenial

# safelist
branches:
  only:
  - travisbuild 

env:
  - OCTOKIT_API_ENDPOINT="https://github.com/"

before_install:
  # On Pull commit to master, build the helm repo
  - echo "Install helm"
  - env | egrep "TRAVIS|MASTER"
  - curl https://raw.githubusercontent.com/kubernetes/helm/master/scripts/get | bash
  - helm init --client-only

   
install:
  # Package for release 
  - echo "In Install path"
  # The process will be very limited, and will look for commits
  - if [[ ! "$TRAVIS_COMMIT_MESSAGE" = "Do Not Trigger"* ]] && [[ "$TRAVIS_PULL_REQUEST" = "false" ]] && [[ "$TRAVIS_BRANCH" = "$MASTER_BUILD" ]] && [[ "$TRAVIS_EVENT_TYPE" = "push" ]] && [[ "$TRAVIS_REPO_SLUG" = "IBM/Charts" ]]; 
      then
        curl https://raw.githubusercontent.com/kubernetes/helm/master/scripts/get | bash;
        helm init --client-only; 
        .build/bin/diffIndex.sh;
      else echo "This is a PR, or commit on non-master, no index build";
    fi
