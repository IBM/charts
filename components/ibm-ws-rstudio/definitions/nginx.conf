set_by_lua $nsdomain 'return os.getenv("NS_DOMAIN")';
location ~ ^/dsx-rstudio/ibmdsxuser-(.*?)/(.*?)/(.*?)/(.*) {
    access_by_lua_file /nginx_data/checkjwt.lua;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";
    proxy_set_header Host $host;
    rewrite ^/dsx-rstudio/ibmdsxuser-(.*?)/(.*?)/(.*?)/(.*)$ /$4 break;
    proxy_pass https://$3-svc.$nsdomain:8443;
    proxy_read_timeout 10m;
    expires 2d;
    add_header Cache-Control "public, no-transform";
    add_header X-Content-Type-Options nosniff;
    add_header X-Frame-Options SAMEORIGIN;
    add_header X-XSS-Protection "1; mode=block;";
}
location ~ ^/(dsvc|dmodel)/v1/(.*?)/rscript/(.*?)/(.*) {
  proxy_http_version 1.1;
  proxy_set_header Host $host;
  rewrite ^/dsvc/v1/(.*?)/rscript/(.*?)/(.*)$ /raas-server/$1/$3 break;
  rewrite ^/dmodel/v1/(.*?)/rscript/(.*?)/(.*)$ /raas-server/$1/$3 break;
  proxy_set_header DEPLOYMENT $2;
  proxy_pass http://$1-rscript-$2-svc.$nsdomain:7330;
}
location ~ ^/dsx-r-script/ibmdsxuser-(.*?)/(.*?)/(.*?)/(.*)$ {
  access_by_lua_file /nginx_data/checkjwt.lua;
  proxy_http_version 1.1;
  proxy_set_header Upgrade $http_upgrade;
  proxy_set_header Connection "upgrade";
  proxy_set_header Host $host;
  rewrite ^/dsx-r-script/ibmdsxuser-(.*?)/(.*?)/(.*)$ /$4 break;
  proxy_pass http://$3-svc.$nsdomain:8011;
  proxy_read_timeout 10m;
}
location ~ ^/dsx-shiny-preview/ibmdsxuser-(.*?)/(.*?)/(.*?)/(.*)$ {
  access_by_lua_file /nginx_data/checkjwt.lua;
  proxy_http_version 1.1;
  proxy_set_header Upgrade $http_upgrade;
  proxy_set_header Connection "upgrade";
  proxy_set_header Host $host;
  rewrite ^/dsx-shiny-preview/ibmdsxuser-(.*?)/(.*?)/(.*)$ /$4 break;
  proxy_pass http://$3-svc.$nsdomain:3838;
  proxy_read_timeout 10m;
}
location ~ ^/dsx-publish-view-shiny/\^\^all__/(.*)$ {
  proxy_http_version 1.1;
  proxy_set_header Upgrade $http_upgrade;
  proxy_set_header Connection "upgrade";
  proxy_set_header Host $host;
  rewrite ^/dsx-publish-view-shiny/(.*)$ /$1 break;
  proxy_pass http://r-publish-content-api-svc:3838;
  proxy_read_timeout 10m;
}
location ~ ^/dsx-publish-view-app/\^\^all__/(.*)$ {
  alias /nginx_data/html/dsx/dsx-publish-public.html;
  gzip_static on;
  expires max;
  add_header Cache_Control public;
  add_header Content-Type text/html;
  sub_filter '__replacementString**'  '/dsx-publish-view-shiny/^^all__/$1/';
  sub_filter_once on;
  sub_filter_types *;
}
location ~ ^/dsx-publish-view-shiny-all-auth/\^\^all_auth/(.*)$ {
  access_by_lua_file /nginx_data/checkjwt.lua;
  proxy_http_version 1.1;
  proxy_set_header Host $host;
  rewrite ^/dsx-publish-view-shiny-all-auth/\^\^all_auth/(.*)$ /dsx-get-shiny-app/$1 break;
  proxy_pass http://r-publish-content-api-svc:7330;
  proxy_read_timeout 10m;
}
location ~ ^/dsx-publish-view-shiny-auth/(.*)$ {
  access_by_lua_file /nginx_data/checkjwt.lua;
  proxy_http_version 1.1;
  proxy_set_header Host $host;
  proxy_pass http://r-publish-content-api-svc:7330;
  proxy_read_timeout 10m;
}
location ~ ^/dapp/v1/(.*?)/shinyapp/(.*?)/(.*)$ {
  proxy_http_version 1.1;
  proxy_set_header Host $host;
  rewrite ^/dapp/v1/(.*?)/shinyapp/(.*?)/(.*) /shiny-server/$1/shinyapp/$2/$3 break;
  proxy_set_header DEPLOYMENT $2;
  proxy_pass http://$1-shinyapp-$2-svc.$nsdomain:7330;
}