
# We need to have the isIcp flag enabled only for the PPA delivery for rest all the
# secrets needs to be created. The one to skip in PPA is docker registry entry
{{- template "isIcp" . -}}
{{- if not (.Values.isIcp) }}

# mongodb
apiVersion: v1
kind: Secret
metadata:
  name: mongodb-creds
  labels:
{{ include "core.labels" .  | indent 4 }}
type: Opaque
data:
 {{ if ne (.Values.enableExternalMongoDB|quote|lower) "\"true\"" }}
  mongodb.url : {{ printf "mongodb://IamTheBigRootUser:%s@mongodb:27017/admin" .Values.secrets.mongodb.password | b64enc | quote }}
 {{ else }}
  mongodb.url : {{ .Values.externalMongoDBUrl | b64enc | quote }}
 {{ end }}
  mongodb.username: {{ "IamTheBigRootUser" | b64enc | quote }}
  mongodb.password: {{ required "secrets.mongodb.password is required!" .Values.secrets.mongodb.password | b64enc | quote }}
{{ end }}
