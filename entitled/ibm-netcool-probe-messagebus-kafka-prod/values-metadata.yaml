## Metadata for the IBM Netcool/OMNIBus Message Bus Probe for Kafka Integration
## This metadata is used to augment the value.yaml to drive IPC UI for configuration of the Helm chart installation


## License acceptance
license:
  __metadata:
    name: "license"
    label: "Docker image license acceptance"
    description: "Must be set to \"accept\" to proceed with installation. Defaults to \"not accepted\"."
    type: "string"
    immutable: false
    required: true
    hidden: false
    options:
    - label: "Not Accepted"
      value: "not accepted"
    - label: "Accept"
      value: "accept"


messagebus:
  __metadata:
    label: "Message Bus Probe For Kafka Configuration."
    name: "messagebus"
    description: "Properties for configuring the IBM Netcool/OMNIBus Message Bus Probe for Kafka helm chart."

  ## License acceptance
  license:
    __metadata:
      name: "license"
      label: "Docker image license acceptance"
      description: "Must be set to \"accept\" to proceed with installation. Defaults to \"not accepted\"."
      type: "string"
      immutable: false
      required: true
      hidden: true
      options:
      - label: "Accept"
        value: "accept"

  global:
    image:
      secretName:
        __metadata:
          name: "Image Pull Secret Name"
          label: "Global Image Pull Secret Name"
          description: "The name of the respective secret name returned from kubectl get secret."
          type: "string"
          immutable: false
          required: false
    serviceAccountName:
      __metadata:
        label: "Service Account Name"
        description: >
          If the Cluster Administrator has already created a service account in the namespace, specify the name of the service account here.
          If left blank, the chart will automatically create a new service account in the namespace when it is deployed. This new service account will be removed from
          the namespace when the chart is removed.
        type: "string"
        required: false

  ## Image configuration metadata
  image:
    repository:
      __metadata:
        name: "repository"
        label: "Docker Image Repository"
        description: "Docker image repository. The image name should be set to \"netcool-probe-messagebus\"."
        type: "string"
        immutable: false
        required: true
    tag:
      __metadata:
        name: "tag"
        label: "Docker Image Tag"
        description: "Specific image tag to use."
        type: "string"
        immutable: false
        required: true
    testRepository:
      __metadata:
        name: "testRepository"
        label: "Test Image Repository"
        description: "Docker image repository for the test image."
        type: "string"
        immutable: false
        required: true
    testImageTag:
      __metadata:
        name: "testImageTag"
        label: "Docker test image tag"
        description: "Specific image tag to use for the test image"
        type: "string"
        immutable: false
        required: true
    pullPolicy:
      __metadata:
        name: "pullPolicy"
        label: "Docker Image Pull Policy"
        description: "Always, Never, or IfNotPresent. Defaults to IfNotPresent."
        type: "string"
        immutable: false
        required: true
        options:
        - label: "Always"
          value: "Always"
        - label: "Never"
          value: "Never"
        - label: "IfNotPresent"
          value: "IfNotPresent"

  # Netcool Object Server configuration
  netcool:
    connectionMode:
      __metadata:
        name: "connectionMode"
        label: "Connection Mode"
        description: > 
          The connection mode when establishing a connection with the Object Server.
          Requires a pre-created secret containing files/values for secured communication except for "Default" mode.
        type: "string"
        immutable: false
        required: true
        options:
        - label: "Default - Authentication and SSL disabled."
          value: "Default"
        - label: "AuthOnly - Authentication enabled only."
          value: "AuthOnly"
        - label: "SSLOnly - SSL enabled only."
          value: "SSLOnly"
        - label: "SSLAndAuth - SSL and authentication enabled."
          value: "SSLAndAuth"
    primaryServer:
      __metadata:
        name: "primaryServer"
        label: "Primary Object Server Name"
        description: "The Primary Netcool/OMNIbus Object Server Name (Usually set to NCOMS or AGG_P)."
        type: "string"
        immutable: false
        required: true
    primaryHost:
      __metadata:
        name: "primaryHost"
        label: "Primary Object Server Host"
        description: "The Primary Netcool/OMNIbus Object Server Hostname or IP address."
        type: "string"
        immutable: false
        required: true
    primaryPort:
      __metadata:
        name: "primaryPort"
        label: "Primary Object Server Port"
        description: "The Primary Netcool/OMNIbus Object Server Port number."
        type: "number"
        immutable: false
        required: true
    backupServer:
      __metadata:
        name: "backupServer"
        label: "Backup Object Server Name"
        description: >
          The Backup Netcool/OMNIbus Object Server Name. If the backupServer, backupHost 
          and backupPort parameters are defined in addition
          to the primaryServer, primaryHost, and primaryPort parameters, the probe
          will be configured to connect to a virtual object server pair called AGG_V.
        type: "string"
        immutable: false
        required: false
    backupHost:
      __metadata:
        name: "backupHost"
        label: "Backup Object Server Host"
        description: "The Backup Netcool/OMNIbus Object Server Hostname or IP address."
        type: "string"
        immutable: false
        required: false
    backupPort:
      __metadata:
        name: "backupPort"
        label: "Backup Object Server Port"
        description: "The Backup Netcool/OMNIbus Object Server Port number."
        type: "number"
        immutable: false
        required: false
    secretName:
      __metadata:
        name: "secretName"
        label: "Probe-Server Communication Secret"
        description: "Secret containing the required files/values for secured communication."
        type: "string"
        immutable: false
        required: false

  ## Probe configuration
  probe:
    messageLevel:
      __metadata:
        name: "messageLevel"
        label: "Probe Log Message Level"
        description: "The Probe log message level."
        type: "string"
        immutable: false
        required: false
        options:
        - label: "Fatal"
          value: "fatal"
        - label: "Error"
          value: "error"
        - label: "Warning"
          value: "warn"
        - label: "Info"
          value: "info"
        - label: "Debug"
          value: "debug"
    setUIDandGID:
      __metadata:
        label: "Set the User ID and Group ID for the Probe process"
        description: >
          The probe processes in the container are run by the netcool user. When set to true, the helm chart will specify the UID and GID values to 
          be assigned to the netcool user. Otherwise if false, the netcool user will not be assigned any UID or GID by the helm chart.
        type: "boolean"
        required: true
    sslServerCommonName:
      __metadata:
        name: "sslServerCommonName"
        label: "SSL Server Common Names"
        description: "A comma-separated list of acceptable SSL Common Names when connecting to Object Server using SSL."
        type: "string"
        immutable: false
        required: false
    locale:
      __metadata:
        name: "locale"
        label: "Environment Locale Setting"
        description: "Used as the LC_ALL environment variable."
        type: "string"
        immutable: false
        required: false
    transportType:
      __metadata:
        name: "transportType"
        label: "Transport Type"
        description: "The transport method to be used."
        type: "string"
        immutable: false
        required: true
        hidden: false
        options:
        - label: "KAFKA"
          value: "KAFKA"
    heartbeatInterval:
      __metadata:
        name: "heartbeatInterval"
        label: "Heartbeat Interval"
        description: "Interval between successive connection status checks in seconds."
        type: "number"
        immutable: false
        required: false
    secretName:
      __metadata:
        name: "secretName"
        label: "HTTP and Kafka Authentication Credentials Secret"
        description: "Secret containing the authentication credentials for HTTP and Kafka Transport."
        type: "string"
        immutable: false
        required: false
    rulesConfigmap:
      __metadata:
        name: "rulesConfigmap"
        label: "Custom Rules File ConfigMap Name"
        description: "Overrides the template probe rules files with this ConfigMap. The ConfigMap must have the probe rules in message_bus.rules key."
        type: "string"
        required: false
    # Probe's JSON Parser Configuration
    jsonParserConfig:
      messagePayload:
        __metadata:
          description: 'Point to the attribute which contains payload from the JSON message. Must have "json." prefix if set.'
          hidden: false
          immutable: false
          label: 'Parser: JSON Message Payload (Consumer Events)'
          required: true
          type: string
      messageHeader:
        __metadata:
          description: 'Point to the attribute which contains headers from the JSON message in addition to payload. Must have "json." prefix if set.'
          hidden: false
          immutable: false
          label: 'Parser: JSON Message Header (Consumer Events)'
          required: false
          type: string
      jsonNestedPayload:
        __metadata:
          description: 'Can be pointed to the attribute which contains payload from a nested JSON string. Must have "json." prefix if set.'
          hidden: false
          immutable: false
          label: 'Parser: Nested JSON Payload (Consumer Events)'
          required: false
          type: string
      jsonNestedHeader:
        __metadata:
          description: 'Can be pointed to the attribute which contains headers from a nested JSON string. Must have "json." prefix if set.'
          hidden: false
          immutable: false
          label: 'Parser: Nested JSON Header (Consumer Events)'
          required: false
          type: string
      messageDepth:
        __metadata:
          description: 'The number of JSON child node levels to traverse.'
          hidden: false
          immutable: false
          label: 'Parser: Message Depth (Consumer Events)'
          required: false
          type: number

  ## Kafka configuration
  kafka:
    connection:
      zookeeperClient:
        target:
          __metadata:
            name: "target"
            label: "ZooKeeper Client Target"
            description: "Use this property to specify the ZooKeeper endpoint. Example: \"zookeeper:2181\""
            type: "string"
            immutable: false
            required: false
        topicWatch:
          __metadata:
            name: "topicWatch"
            label: "Enable ZooKeeper Topic Watch Service"
            description: "Use this property to enable the ZooKeeper topic watch service."
            type: "boolean"
            required: false
        brokerWatch:
          __metadata:
            name: "brokerWatch"
            label: "Enable ZooKeeper Broker Watch Service"
            description: "Use this property to enable the ZooKeeper broker watch service."
            type: "boolean"
            required: false
      brokers:
        __metadata:
          name: "brokers"
          label: "Brokers"
          description: "Use this property to specify the broker endpoints in a comma-separated list. Example: \"PLAINTEXT://kafkaserver1:9092,PLAINTEXT://kafkaserver2:9092\""
          type: "string"
          immutable: false
          required: true
      topics:
        __metadata:
          name: "topics"
          label: "Topics"
          description: "Use this property to specify topics in a comma-separated list. Example: \"topicABC,topicXYZ\""
          type: "string"
          immutable: false
          required: false
    client:
      securityProtocol:
        __metadata:
          name: "securityProtocol"
          label: "Security Protocol"
          description: "The Security Protocol."
          type: "string"
          immutable: false
          required: true
          options:
          - label: "PLAINTEXT"
            value: "PLAINTEXT"
          - label: "SASL_PLAINTEXT"
            value: "SASL_PLAINTEXT"
          - label: "SASL_SSL"
            value: "SASL_SSL"
          - label: "SSL"
            value: "SSL"
      ssl:
        trustStoreSecretName:
          __metadata:
            name: "trustStoreSecretName"
            label: "TrustStore Secret"
            description: "Secret containing the TrustStore file with its password."
            type: "string"
            immutable: false
            required: false
        keyStoreSecretName:
          __metadata:
            name: "keyStoreSecretName"
            label: "KeyStore Secret"
            description: "Secret containing the KeyStore file with its password."
            type: "string"
            immutable: false
            required: false
      saslPlainMechanism:
        __metadata:
          name: "saslPlainMechanism"
          label: "SASL PLAIN Mechanism"
          description: "Enable the PLAIN mechanism for Simple Authentication and Security Layer connections."
          type: "boolean"
          required: true
      consumer:
        groupId:
          __metadata:
            name: "groupId"
            label: "Group Identifier"
            description: "The Group Identifier. Example: \"test-consumer-group\""
            type: "string"
            immutable: false
            required: true

    ## Replica count configuration metadata
  replicaCount: 
    __metadata:
      name: "replicaCount"
      label: "Replica Count"
      description: "Deployment replicaCount - optional field dependent on workload"
      type: "number"
      immutable: false
      required: false

  autoscaling:
    enabled:
      __metadata:
        label: "Enable Horizontal Pod autoscaling"
        description: "Pod will scale based on the autoscaling parameters"
        type: "boolean"
        required: false
    minReplicas:
      __metadata:
        label: "Minimum replicas"
        description: "Minimum number of probe replicas at any point in time"
        type: "number"
        required: false
    maxReplicas:
      __metadata:
        label: "Maximum replicas"
        description: "Maximum number of probe replicas at any point in time"
        type: "number"
        required: false
    cpuUtil:
      __metadata:
        label: "Target CPU utilization"
        description: "Target average CPU utilization (represented as a percentage of requested CPU) over all the pods. Example: set to `60` for 60% target utilization."
        type: "number"
        required: false
  poddisruptionbudget:
    enabled:
      __metadata:
        label: "Enable Pod Disruption Budget"
        description: "Enables application protection availability during a cluster node maintenance. Administrator role or higher required to enable PDB."
        type: "boolean"
        required: false
    minAvailable:
      __metadata:
        label: "Minimum number of replicas"
        description: "Minimum number of probe replicas that must be available during pod eviction"
        type: "string"
        required: false

  ## Resource requests and limits configuration metadata
  resources:
    requests:
      cpu: 
        __metadata: 
          label: "CPU request"
          description: "The requested CPU"
          type: "string"
          required: true   
      memory: 
        __metadata: 
          label: "Memory request"
          description: "The memory request"
          type: "string"
          required: true   
    limits:
      cpu: 
        __metadata: 
          label: "CPU limit"
          description: "The CPU limit"
          type: "string"
          required: true   
      memory: 
        __metadata: 
          label: "Memory limit"
          description: "The memory limit"
          type: "string"
          required: true   

  arch:
    __metadata:
      name: "Architecture"
      label: "Worker node architecture"
      description: "Worker node architecture to deploy to. Supports AMD64 architecture only."
      type: "string"
      immutable: true
      required: true
      options:
      - label: "AMD64"
        value: "amd64"
