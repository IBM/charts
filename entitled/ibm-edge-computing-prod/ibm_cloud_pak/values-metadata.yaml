## Metadata for IBM Edge Computing configuration
## This metadata is used to drive IBM Cloud Private UI for configuration of the Helm chart installation

arch:
  __metadata:
    label: "Hardware architecture preferences"
    description: "Targets a specific hardware architecture for the worker node."
    type: "string"
    immutable: true
    required: true

# Globals
global:
  __metadata:
    label: "Global configuration"
    description: "Configuration that can be applied globally to the entire IEC installation."
  image:
    pullPolicy:
      __metadata:
        label: "Pull policy"
        description: "This option sets the policy that determines how images are pulled."
        type: "string"
        required: true
    repository:
      __metadata:
        label: "Global image repository"
        description: "This option sets the default image repository for the IEC installation."
        type: "string"
        required: false
    pullSecret:
      __metadata:
        label: "Global image secret"
        description: "This option sets the default secret for pulling docker images for the IEC installation."
        type: "string"
        required: false

        
## Common Configuration
common:
  __metadata:
    label: "Common Configuration"
    description: "These configuration options are applied to all the IEC management hub components, e.g. Agbot, Exchange, MMS, UI."
  servicePort:
    __metadata:
      label: "Service port"
      description: "Set the internal cluster port where all the IEC management hub components will accept network requests from the the cluster ingress."
      type: "number"
      required: true
  httpPort:
    __metadata:
      label: "HTTP port"
      description: "The network port exposed by the docker container which the equivalent service will direct traffic to."
      type: "number"
      required: true
  clusterUrl:
    __metadata:
      label: "Cluster URL"
      description: "The URL of this cluster."
      type: "string"
      required: true
  maxSurge:
    __metadata:
      label: "Maximum surge"
      description: "The number of pod replicas that can come online at the same time."
      type: "string"
      required: true

localDBs:
  __metadata:
    label: "Local database configuration"
    description: "Configuration for local database usage"
  enabled:
    __metadata:
      label: "Enable local databases"
      description: "Runs local database instances (2 postgresql and 1 mongodb) for the agbot, exchange, and CSS"
      type: "boolean"
      required: true
remoteDBs:
  __metadata:
    label: "Remote database configuration"
    description: "Configuration for remote database usage"
  enableAgbotTLS:
    __metadata:
      label: "Enable Agbot TLS"
      description: "Enables TLS for the Agbot, further defined by the 'edge-computing-remote-dbs' secret"
      type: "boolean"
      required: true
  enableCssTLS:
    __metadata:
      label: "Enable CSS TLS"
      description: "Enables TLS for the Cloud Sync Service, further defined by the 'edge-computing-remote-dbs' secret"
      type: "boolean"
      required: true
  enableExchangeTLS:
    __metadata:
      label: "Enable Exchange TLS"
      description: "Enables TLS for the Exchange, further defined by the 'edge-computing-remote-dbs' secret"
      type: "boolean"
      required: true

## Agbot configuration
agbot:
  __metadata:
    label: "Agbot configuration"
    description: "The configuration variables for the Agbot."
  replicaCount:
    __metadata:
      label: "Agbot replica count"
      description: "The number of Agbot replicas that should be running in the cluster. Production clusters should have at least 2."
      type: "number"
      required: true
  maxUnavailable:
    __metadata:
      label: "Agbot maximum unavailable"
      description: "The maximum number of Agbot replicas that can be unavailable during the rolling update process."
      type: "string"
      required: true
  image:
    __metadata:
      label: "Agbot image name"
      description: "The name of the Agbot docker image."
      type: "string"
      required: true
  tag:
    __metadata:
      label: "Agbot image tag"
      description: "The Agbot docker image tag name."
      type: "string"
      required: true
  loglevel:
    __metadata:
      label: "Agbot log level"
      description: "The Agbot log level (1-6). Use 3 for production and non-production. Do not use values higher than 3 unless directed by IBM support."
      type: "number"
      required: true
  resources:
    limits:
      cpu:
        __metadata:
          label: "Agbot CPU limit"
          description: "This option sets a limit on CPU consumption by the Agbot."
          type: "string"
          required: true
      memory:
        __metadata:
          label: "Agbot memory limit"
          description: "This option sets a limit on memory consumption by the Agbot."
          type: "string"
          required: true
    requests:
      cpu:
        __metadata:
          label: "Agbot CPU requirement"
          description: "This option establishes the CPU requirement of the Agbot."
          type: "string"
          required: true
      memory:
        __metadata:
          label: "Agbot memory requirement"
          description: "This option establishes the memory requirement of the Agbot."
          type: "string"
          required: true 

## Exchange Configuration
exchange:
  __metadata:
    label: "Exchange configuration"
    description: "The configuration values for the Exchange."
  replicaCount:
    __metadata:
      label: "Exchange replica count"
      description: "The number of Exchange replicas that should be running in the cluster. Production clusters should have at least 2."
      type: "number"
      required: true
  maxUnavailable:
    __metadata:
      label: "Exchange maximum unavailable"
      description: "The maximum number of Exchange replicas that can be unavailable during the rolling update process."
      type: "string"
      required: true
  image:
    __metadata:
      label: "Exchange image name"
      description: "The name of the Exchange docker image."
      type: "string"
      required: true
  tag:
    __metadata:
      label: "Exchange image"
      description: "The name of the Exchange docker image tag."
      type: "string"
      required: true
  path:
    __metadata:
      label: "Exchange context root"
      description: "The context root used to access the Exchange through ingress to make API calls."
      type: "string"
      required: true
  loglevel:
    __metadata:
      label: "Exchange log level"
      description: "The Exchange log level; OFF, ERROR, WARN, INFO, DEBUG, TRACE, or ALL. Use INFO for production and non-production use."
      type: "string"
      required: true
  dbPool:
    __metadata:
      label: "Exchange database connection pool"
      description: "The Exchange DB connection pool size per replica. Ensure that the Exchange DB supports this number of connections times the max exchange replicas."
      type: "number"
      required: true
  cache:
    idsMaxSize:
      __metadata:
        label: "Maximum identities"
        description: "The max number of identities that one exchange replica will cache. This value is larger than the sum of all nodes, agbots and users."
        type: "number"
        required: true
    resourcesMaxSize:
      __metadata:
        label: "Maximum resource size"
        description: "The max number of definitions (agbots, services, patterns, or policies) that have their auth information (owner, public) cached in memory."
        type: "number"
        required: true
  resources:
    limits:
      cpu:
        __metadata:
          label: "Exchange CPU limit"
          description: "This option sets a limit on CPU consumption by the Exchange."
          type: "string"
          required: true
      memory:
        __metadata:
          label: "Exchange memory limit"
          description: "This option sets a limit on memory consumption by the Exchange."
          type: "string"
          required: true
    requests:
      cpu:
        __metadata:
          label: "Exchange CPU requirement"
          description: "This option establishes the CPU requirement of the Exchange."
          type: "string"
          required: true
      memory:
        __metadata:
          label: "Exchange memory requirement"
          description: "This option establishes the memory requirement of the Exchange."
          type: "string"
          required: true
  autoscaling:
    enabled:
      __metadata:
        label: "Autoscaling enabled"
        description: "Enable or disable Exchange auto-scaling."
        type: "boolean"
        required: true
    maxReplicas:
      __metadata:
        label: "Maximum replicas"
        description: "The maximum number of Exchange replicas that auto-scaling can start."
        type: "string"
        required: true
    cpu:
      __metadata:
        label: "Exchange CPU autoscaling resource limit"
        description: "The percentage of CPU resources consumed, in relation to the CPU resource request size, that will trigger a new Exchange replica."
        type: "string"
        required: true
    memory:
      __metadata:
        label: "Exchange memory autoscaling resource limit"
        description: "The percentage of memory resources consumed, in relation to the memory resource request size, that will trigger a new Exchange replica."
        type: "string"
        required: true
    minReplicas:
      __metadata:
        label: "Minimum replicas"
        description: "The minimum number of Exchange replicas that auto-scaling must ensure exist at all times."
        type: "string"
        required: true

## CSS Configuration
css:
  __metadata:
    label: "Model Management Configuration"
    description: "The configuration for the Model Management System."
  replicaCount:
    __metadata:
      label: "Model Management replicas"
      description: "This option sets the number of Model Management instances that should be running."
      type: "number"
      required: true
  maxUnavailable:
    __metadata:
      label: "MMS maximum unavailable"
      description: "The maximum number of MMS replicas that can be unavailable during the rolling update process."
      type: "string"
      required: true
  image:
    __metadata:
      label: "MMS image name"
      description: "The name of the MMS docker image."
      type: "string"
      required: true
  tag:
    __metadata:
      label: "MMS image tag"
      description: "The MMS docker image tag name."
      type: "string"
      required: true
  path:
    __metadata:
      label: "MMS context root"
      description: "The context root used to access the MMS through ingress to make API calls."
      type: "string"
      required: true
  resources:
    limits:
      cpu:
        __metadata:
          label: "MMS CPU limit"
          description: "This option sets a limit on CPU consumption by the MMS."
          type: "string"
          required: true
      memory:
        __metadata:
          label: "MMS memory limit"
          description: "This option sets a limit on memory consumption by the MMS."
          type: "string"
          required: true
    requests:
      cpu:
        __metadata:
          label: "MMS CPU requirement"
          description: "This option establishes the CPU requirement of the MMS."
          type: "string"
          required: true
      memory:
        __metadata:
          label: "MMS memory requirement"
          description: "This option establishes the memory requirement of the MMS."
          type: "string"
          required: true
    
## UI Configuration
ui:
  __metadata:
    label: "User Interface Configuration"
    description: "The configuration for the User Interface."
  replicaCount:
    __metadata:
      label: "UI replicas"
      description: "This option sets the number of UI instances that should be running."
      type: "string"
      required: true
  maxUnavailable:
    __metadata:
      label: "UI maximum unavailable"
      description: "The maximum number of UI replicas that can be unavailable during the rolling update process."
      type: "string"
      required: true
  image:
    __metadata:
      label: "UI image name"
      description: "The name of the UI docker image."
      type: "string"
      required: true
  tag:
    __metadata:
      label: "UI image tag"
      description: "The UI docker image tag name."
      type: "string"
      required: true
  path:
    __metadata:
      label: "UI context root"
      description: "The context root used to access the UI through ingress to make API calls. The value must have a trailing slash."
      type: "string"
      required: true
  pathEdge:
    __metadata:
      label: "UI edge context root"
      description: "The context root that the ICP menu redirects to."
      type: "string"
      required: true
      immutable: true
  uiMenu:
    enabled:
      __metadata:
        label: "Enable UI menu"
        description: "Enable edge-computing link in the add-ons menu. In 3.2.1 ICP+MCM edge-computing is automatically added to the menu."
        type: "boolean"
        required: false
    name:
      __metadata:
        label: "UI menu name"
        description: "This option sets the UI menu name."
        type: "string"
        required: true
    id:
      __metadata:
        label: "UI menu id"
        description: "This option sets the menu id."
        type: "string"
        required: true
    roles:
      __metadata:
        label: "UI menu roles"
        description: "This option sets the menu roles."
        type: "string"
        required: true
  resources:
    limits:
      cpu:
        __metadata:
          label: "UI CPU limit"
          description: "This option sets a limit on CPU consumption by the UI."
          type: "string"
          required: true
      memory:
        __metadata:
          label: "UI memory limit"
          description: "This option sets a limit on memory consumption by the UI."
          type: "string"
          required: true
    requests:
      cpu:
        __metadata:
          label: "UI CPU requirements"
          description: "This option establishes the CPU requirement of the UI."
          type: "string"
          required: true
      memory:
        __metadata:
          label: "UI memory requirement"
          description: "This option establishes the memory requirement of the UI."
          type: "string"
          required: true

## secretgen Configuration
kubectl:
  __metadata:
    label: "Kubectl configuration"
    description: "The configuration of the kubectl image."
  image:
    __metadata:
      label: "Kubectl image name"
      description: "The name of the kubectl image."
      type: "string"
      required: true
  tag:
    __metadata:
      label: "Kubectl tag"
      description: "The tag name of the kubectl image."
      type: "string"

## Dashboard configuration enablement metadata
dashboard:
  __metadata:
    label: "Dashboard Configuration"
    description: "The configuration for the monitoring Dashboard."
  enabled:
    __metadata:
      label: "Dashboard enabled"
      description: "This option enables the monitoring Dashboard."
      type: "boolean"
      required: true
