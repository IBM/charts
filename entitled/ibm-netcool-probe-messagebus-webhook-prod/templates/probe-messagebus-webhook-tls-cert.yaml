{{- if not .Values.ingress.tls.secretName -}}
{{- include "sch.config.init" (list . "probe.sch.chart.config.values") -}}
{{- $tlsenabled := include "ibm-netcool-probe-messagebus-webhook-prod.performvalidation" ( . ) -}}
{{- if eq $tlsenabled "httpsOk" -}}
{{- $compName :=  .sch.chart.components.probe.name -}}
{{- $releaseName := .Release.Name -}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "sch.names.fullCompName" (list .  $compName) }}
  labels:
{{ include "sch.metadata.labels.standard" (list . $compName) | indent 4 }}
type: kubernetes.io/tls 
data:
  {{ $ca := genCA .Values.ingress.tls.caName 3650 }}
  {{- $host :=  .Values.ingress.host  }}
  {{- $hostname := (printf "%s.%s" $releaseName  $host  ) }}
  {{- $cert := genSignedCert $hostname nil nil 3650 $ca -}}
  tls-ca.crt: {{ print $ca.Cert | b64enc }}
  tls-ca.key: {{ print $ca.Key | b64enc }}
  tls.crt: {{ print $cert.Cert  | b64enc}}
  tls.key: {{ print $cert.Key |  b64enc }}
{{- end }}
{{- end }}