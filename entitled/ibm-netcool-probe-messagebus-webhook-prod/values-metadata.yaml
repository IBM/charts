## Metadata for MessageBus Webhook configuration

global:
  __metadata:
    label: "Global"
    description: "Global scope"
  image:
    secretName:
      __metadata:
        name: "secretName"
        label: "Secret Name"
        description: "Secret Name to pull image"


## License acceptance
license:
  __metadata:
    name: "license"
    label: "Docker image license acceptance"
    description: "Must be set to \"accept\" to proceed with installation. Defaults to Not Accepted."
    type: "string"
    immutable: false
    required: true
    hidden: false
    options:
    - label: "Not Accepted"
      value: "not accepted"
    - label: "Accept"
      value: "accept"

## Arch metadata
arch:
  __metadata:
    name: "amd64"
    label: "Architecture scheduling preferences"
    description: "Architecture preference for target worker node."
    type: "string"
    options:
      - label: "amd64"
        value: "amd64"
    immutable: true
    required: true

## Replica count configuration metadata
replicaCount: 
  __metadata:
    name: "replicaCount"
    label: "Replica Count"
    description: "Deployment replicaCount - optional field dependent on workload"
    type: "number"
    immutable: false
    required: false


## Image configuration metadata
image:
  __metadata:
      label: "Docker Image"
      name: "image"
      description: "Docker Image Configuration"
  repository:
    __metadata:
      name: "repository"
      label: "Docker Image Repository"
      description: "Docker image repository. The image name should be set to \"netcool-probe-messagebus\"."
      type: "string"
      immutable: false
      required: true
  tag:
    __metadata:
      name: "tag"
      label: "Docker image Tag"
      description: "Specific image tag to use."
      type: "string"
      immutable: false
      required: true
  testRepository:
    __metadata:
      name: "testRepository"
      label: "Test Image Repository"
      description: "Docker image repository for the test image."
      type: "string"
      immutable: false
      required: true
  testImageTag:
    __metadata:
      name: "testImageTag"
      label: "Docker test image tag"
      description: "Specific image tag to use for the test image"
      type: "string"
      immutable: false
      required: true
  pullPolicy:
    __metadata:
      name: "pullPolicy"
      label: "Docker Image Pull Policy"
      description: "Always, Never, or IfNotPresent. Defaults to IfNotPresent"
      type: "string"
      immutable: false
      required: true
      options:
      - label: "Always"
        value: "Always"
      - label: "Never"
        value: "Never"
      - label: "If Not Present"
        value: "IfNotPresent"


## Netcool Object Server configuration
netcool:
  __metadata:
    label: "Object Server"
    description: "Object Server Configuration"
  primaryServer:
    __metadata:
      name: "primaryServer"
      label: "Primary Object Server Name"
      description: "The Primary Netcool/OMNIbus Object Server Name (usually set to NCOMS or AGG_P)."
      type: "string"
      immutable: false
      required: true
  primaryHost:
    __metadata:
      name: "primaryHost"
      label: "Primary Object Server Host"
      description: "The Primary Netcool/OMNIbus Object Server Hostname or IP address."
      type: "string"
      immutable: false
      required: true
  primaryPort:
    __metadata:
      name: "primaryPort"
      label: "Primary Object Server Port"
      description: "The Primary Netcool/OMNIbus Object Server Port number."
      type: "number"
      immutable: false
      required: true
  backupServer:
    __metadata:
      name: "backupServer"
      label: "Backup Object Server Name"
      description: >
        The Backup Netcool/OMNIbus Object Server Name. If the backupServer, backupHost 
        and backupPort parameters are defined in addition
        to the primaryServer, primaryHost, and primaryPort parameters, the probe
        will be configured to connect to a virtual object server pair called AGG_V.
      type: "string"
      immutable: false
      required: false
  backupHost:
    __metadata:
      name: "backupHost"
      label: "Backup Object Server Host"
      description: "The Backup Netcool/OMNIbus Object Server Hostname or IP address."
      type: "string"
      immutable: false
      required: false
  backupPort:
    __metadata:
      name: "backupPort"
      label: "Backup Object Server Port"
      description: "The Backup Netcool/OMNIbus Object Server Port number."
      type: "number"
      immutable: false
      required: false

## Probe configuration
probe:
  __metadata:
    label: "Probe Configuration"
    description: "Probe configuration parameters."
  messageLevel:
    __metadata:
      name: "messageLevel"
      label: "Probe Log Message Level"
      description: "The Probe log message level."
      type: "string"
      immutable: false
      required: false
      options:
      - label: "Fatal"
        value: "fatal"
      - label: "Error"
        value: "error"
      - label: "Warning"
        value: "warn"
      - label: "Info"
        value: "info"
      - label: "Debug"
        value: "debug"
  initialResync:
    __metadata:
      name: "initialResync"
      label: "HTTP Client: Initial Resync"
      description: "Specify whether the probe performs re-synchronization on startup to pull events from the target."
      type: "boolean"
  resyncInterval:
    __metadata:
      name: "resyncInterval"
      label: "HTTP Client: Resync Interval (in seconds)"
      description: "The interval (in seconds) where the probe makes successive re-synchronization requests."
      type: "number"
  heartbeatInterval:
    __metadata:
      name: "heartbeatInterval"
      label: "Heartbeat Interval"
      description: "The interval (in seconds) where the probe checks the status of the transport connection."
      type: "number"
      required: true
  host:
    __metadata:
      name: "host"
      label: "HTTP Client: Target Hostname/IP"
      description: "Specify the host name or IP address of the instance of the event source to which the probe connects."
      type: "string"
      required: false
  port:
    __metadata:
      name: "port"
      label: "HTTP Client: Target Port"
      description: "Specify the host port of the instance of the event source to which the probe connects."
      type: "number"
      required: false
  username:
    __metadata:
      name: "username"
      label: "HTTP Client: Username"
      description: "Specify the user account for logging into the event source. Probe uses this value, to replace the ++Username++ token"
      type: "string"
      required: false
  password:
    __metadata:
      name: "password"
      label: "HTTP Client: Password"
      description: "Specify the password associated with the Username property for logging into the event source."
      type: "string"
      required: false
  sslSecretName:
    __metadata:
      name: "sslSecretName"
      label: "HTTP Client: Secret Name for SSL connection to target host."
      description: "A secret name which has server.crt and keystorepassword.txt keys. This will enable the SSL when connecting to the target host:port."
      type: "string"
      required: false
  rulesConfigmap:
    __metadata:
      name: "rulesConfigmap"
      label: "Custom Rules File ConfigMap Name."
      description: "Overrides the template probe rules files with this ConfigMap. The ConfigMap must have the probe rules in message_bus.rules key."
      type: "string"
      required: false

  # Probe's JSON Parser Configuration
  jsonParserConfig:
    notification:
      jsonNestedHeader:
        __metadata:
          description: 'Can be pointed to the attribute which contains headers from a nested JSON string. Must have "json" prefix if set.'
          hidden: false
          immutable: false
          label: 'Parser: Nested JSON Header (Webhook Events)'
          required: false
          type: string
      jsonNestedPayload:
        __metadata:
          description: 'Can be pointed to the attribute which contains payload from a nested JSON string. Must have "json" prefix if set.'
          hidden: false
          immutable: false
          label: 'Parser: Nested JSON Payload (Webhook Events)'
          required: false
          type: string
      messageDepth:
        __metadata:
          description: 'The number of of JSON child node levels to traverse for webhook events.'
          hidden: false
          immutable: false
          label: 'Parser: Message Depth (Webhook Events)'
          required: false
          type: number
      messageHeader:
        __metadata:
          description: 'Point to the attribute which contains headers from the JSON message in addition to payload. Must have "json" prefix if set.'
          hidden: false
          immutable: false
          label: 'Parser: JSON Message Header (Webhook Events)'
          required: false
          type: string
      messagePayload:
        __metadata:
          description: 'Point to the attribute which contains payload from the JSON message. Must have "json" prefix if set.'
          hidden: false
          immutable: false
          label: 'Parser: JSON Message Payload (Webhook Events)'
          required: true
          type: string
    resync:
      messageHeader:
        __metadata:
          description: 'Point to the attribute which contains headers from the JSON message in addition to payload. Must have "json" prefix if set.'
          hidden: false
          immutable: false
          label: 'Parser: JSON Message Header (Re-synchronized Events,if enabled)'
          required: false
          type: string
      messagePayload:
        __metadata:
          description: 'Point to the attribute which contains payload from the JSON message. Must have "json" prefix if set.'
          hidden: false
          immutable: false
          label: 'Parser: JSON Message Payload (Re-synchronized Events,if enabled)'
          required: false
          type: string
      jsonNestedHeader:
        __metadata:
          description: 'Can be pointed to the attribute which contains headers from a nested JSON string. Must have "json" prefix if set.'
          hidden: false
          immutable: false
          label: 'Parser: Nested JSON Header (Re-synchronized Events,if enabled)'
          required: false
          type: string
      jsonNestedPayload:
        __metadata:
          description: 'Can be pointed to the attribute which contains payload from a nested JSON string. Must have "json" prefix if set.'
          hidden: false
          immutable: false
          label: 'Parser: Nested JSON Payload Attribute (Re-synchronized Events,if enabled)'
          required: false
          type: string
      messageDepth:
        __metadata:
          description: 'The number of JSON child node levels to traverse for webhook events.'
          hidden: false
          immutable: false
          label: 'Parser: Message Depth (Re-synchronized Events,if enabled)'
          required: false
          type: number

## Service configuration metadata
service:
  __metadata:
    label: "Service"
    description: "Kubernetes services"
  probe:
    type: 
      __metadata:
        name: "Type"
        label: "Service Type"
        description: "This is the Service Type"
        type: "string"
        immutable: false
        required: true
        options:
          - label: "Cluster IP"
            value: "ClusterIP"
          - label: "Node Port"
            value: "NodePort"

## Ingress configuration enablement metadata
ingress:
  __metadata:
    label: "Ingress"
    description: "Ingress configuration for the Probe Webhook"
  enabled: 
    __metadata: 
      label: "Ingress Enabled" 
      description: "To enable Ingress"
      type: "boolean"
      required: true
  host:
    __metadata:
      name: "host"
      label: "Ingress host name"
      description: "Specifies the hostname in Ingress.The <release_name><.> will be appended as prefix.Ignored when Ingress is disabled,use default value."
      required: true
  annotations:
    __metadata:
      name: "annotations"
      label: "Annotations"
      description: "Specifies resource that store and retrieve arbitrary metadata"
      type: "string"
      required: false
  tls:
    enabled:
      __metadata:
        name: "enabled"
        label: "TLS enabled"
        description: "Set to true to enable TLS in the Ingress of the Webhook."
        type: "boolean"
    secretName:
      __metadata:
        name: "secretName"
        label: "TLS Secret Name"
        description: "Secret Name for Ingress TLS.A pre-created secret containing TLS certificate (tls.crt and tls.key) to use. If unset,a generated secret is used."
        type: "string"
        required: false
    caName:
      __metadata:
        name: "caName"
        label: "Certificate Authority (CA) Name"
        description: "Name to be used as identifier and common name (CN) for CA cert"
        type: "string"


## Resource requests and limits configuration metadata
resources:
  __metadata:
    label: "Resources"
    description: "Required resources"
  requests:
    cpu: 
      __metadata: 
        label: "CPU request"
        description: "The requested CPU"
        type: "string"
        required: true   
    memory: 
      __metadata: 
        label: "Memory request"
        description: "The requested memory"
        type: "string"
        required: true   
  limits:
    cpu: 
      __metadata: 
        label: "CPU limit"
        description: "The CPU limit"
        type: "string"
        required: true   
    memory: 
      __metadata: 
        label: "Memory limit"
        description: "The memory limit"
        type: "string"
        required: true   

# Webhook specified configurations
webhook:
  __metadata:
    label: "Webhook Transport Configuration"
    description: "Configures the Webhook transport."
  uri:
    __metadata:
      label: "Webhook URI"
      description: "The path of Web Hook URI on local server."
      type: "string"
      required: true
  httpVersion:
    __metadata:
      label: "HTTP Version"
      description: "Specify the HTTP protocol version that target system supports."
      type: "string"
      required: true
      immutable: false
      options:
        - label: "1.0"
          value: "1.0"
        - label: "1.1"
          value: "1.1"
  httpHeaders:
    __metadata:
      label: "HTTP Client: HTTP Headers"
      description: "Specify the HTTP header options to use in all HTTP requests. Comma separated list, using the equals sign (=) as the value separator"
      type: "string"
  responseTimeout:
    __metadata:
      label: "HTTP Client: Response Timeout"
      description: "Specify in seconds where the probe waits for a response."
      type: "number"
      required: true
  idleTimeout:
    __metadata:
      label: "HTTP Client: Idle Timeout"
      description: "Specify in seconds where the probe allows a Web Hook to be idle."
      type: "number"
      required: true
  respondWithContent:
    __metadata:
      label: "HTTP Client: Respond with Content"
      description: "Specify whether the probe includes the HTTP body received from the client HTTP request in the HTTP response"
      type: "string"
      options:
        - label: "OFF"
          value: "OFF"
        - label: "ON"
          value: "ON"
  validateBodySyntax:
    __metadata:
      label: "HTTP Client: Validate Body Syntax"
      description: "Specify that the probe performs a JSON syntax format check on the HTTP request body."
      type: "string"
      options: 
        - label: "OFF"
          value: "OFF"
        - label: "ON"
          value: "ON"
  validateRequestURI:
    __metadata:
      label: "HTTP Client: Validate Request URI"
      description: "Specify whether the probe checks the URI paths"
      type: "string"
      options:
        - label: "OFF"
          value: "OFF"
        - label: "ON"
          value: "ON"
  autoReconnect:
    __metadata:
      label: "HTTP Client: Auto Reconnect"
      description: "To re-establish the connection to the HTTP server before sending a HTTP request"
      type: "string"
      options:
        - label: "OFF"
          value: "OFF" 
        - label: "ON"
          value: "ON"
  loginRequest:
    uri:
      __metadata:
        label: "HTTP Client: Login Request URI"
        description: "Specify the URI that the probe uses to request a login"
        type: "string"
    method:
      __metadata:
        label: "HTTP Client: Login Request Method"
        description: "Specify the message type to request a login."
        type: "string"
        options:
          - label: "GET"
            value: "GET"
          - label: "POST"
            value: "POST"
          - label: "PUT"
            value: "PUT"
          - label: "PATCH"
            value: "PATCH"
          - label: "DELETE"
            value: "DELETE"
    content:
      __metadata:
        label: "HTTP Client: Login Request Content"
        description: "Specify any additional information that the probe sends with the login request"
        type: "string"
    headers:
      __metadata:
        label: "HTTP Client: Login Request Headers"
        description: "Specify an HTTP header to send with all login requests, overrides the global HTTP header options configured by the httpHeader"
        type: "string"
  loginRefresh:
    uri:
      __metadata:
        label: "HTTP Client: Login Refresh URI"
        description: "Specify the URI that the probe uses to refresh the login"
        type: "string"
    method:
      __metadata:
        label: "HTTP Client: Login Refresh Method"
        description: "Specify the message type to refresh the login"
        type: "string"
        options:
          - label: "GET"
            value: "GET"
          - label: "POST"
            value: "POST"
          - label: "PUT"
            value: "PUT"
          - label: "PATCH"
            value: "PATCH"
          - label: "DELETE"
            value: "DELETE"
    content:
      __metadata:
        label: "HTTP Client: Login Refresh Content"
        description: "Specify any additional information that the probe sends with the login refresh"
        type: "string"
    headers:
      __metadata:
        label: "HTTP Client: Login Refresh Headers"
        description: "Specify an HTTP header to send with all login refresh, overrides the global HTTP header options configured by the httpHeader"
        type: "string"
    interval:
      __metadata:
        label: "HTTP Client: Login Refresh Interval"
        description: "specify the interval (seconds) that the probe leaves between successive login refresh requests"
        type: "string"
  logoutRequest:
    uri:
      __metadata:
        label: "HTTP Client: Logout Request URI"
        description: "Specify the URI that the probe uses to request a logout"
        type: "string"
    method:
      __metadata:
        label: "HTTP Client: Logout Request Method"
        description: "Specify the message type to request a logout."
        type: "string"
        options:
          - label: "GET"
            value: "GET"
          - label: "POST"
            value: "POST"
          - label: "PUT"
            value: "PUT"
          - label: "PATCH"
            value: "PATCH"
          - label: "DELETE"
            value: "DELETE"
    content:
      __metadata:
        label: "HTTP Client: Logout Request Content"
        description: "Specify any additional information that the probe sends with the logout request"
        type: "string"
    headers:
      __metadata:
        label: "HTTP Client: Logout Request Headers"
        description: "Specify an HTTP header to send with all logout requests, overrides the global HTTP header options configured by the httpHeader"
        type: "string"
  resyncRequest:
    uri:
      __metadata:
        label: "HTTP Client: Resynchronization Request URI"
        description: "Specify the URI that the probe uses to request a resynchronization with the target system at startup"
        type: "string"
    method:
      __metadata:
        label: "HTTP Client: Resynchronization Request Method"
        description: "Specify the message type that the probe sends to request a resynchronization"
        type: "string"
        options:
          - label: "GET"
            value: "GET"
          - label: "POST"
            value: "POST"
          - label: "PUT"
            value: "PUT"
          - label: "PATCH"
            value: "PATCH"
          - label: "DELETE"
            value: "DELETE"
    content:
      __metadata:
        label: "HTTP Client: Resynchronization Request Content"
        description: "Specify any additional information that the probe sends with the resynchronization request"
        type: "string"
    headers:
      __metadata:
        label: "HTTP Client: Resynchronization Request Headers"
        description: "Specify an HTTP header to send with all resynchronization requests, overrides the global HTTP header options configured by the httpHeader"
        type: "string"
  subscribeRequest:
    uri:
      __metadata:
        label: "HTTP Client: Subscription Request URI"
        description: "Specify the URI that the probe uses to request a subscription to receive new alarms"
        type: "string"
    method:
      __metadata:
        label: "HTTP Client: Subscription Request Method"
        description: "Specify the HTTP method that the probe sends to request subscription to receive new alarms"
        type: "string"
        options:
          - label: "GET"
            value: "GET"
          - label: "POST"
            value: "POST"
          - label: "PUT"
            value: "PUT"
          - label: "PATCH"
            value: "PATCH"
          - label: "DELETE"
            value: "DELETE"
    content:
      __metadata:
        label: "HTTP Client: Subscription Request Content"
        description: "Specify any additional information that the probe sends with the subscription request"
        type: "string"
    headers:
      __metadata:
        label: "HTTP Client: Subscription Request Headers"
        description: "Specify an HTTP header to send with all subscription requests, overrides the global HTTP header options configured by the httpHeader"
        type: "string"
  subscribeRefresh:
    uri:
      __metadata:
        label: "HTTP Client: Subscription Refresh URI"
        description: "Specify the URI that the probe uses to request a subscription refresh"
        type: "string"
    method:
      __metadata:
        label: "HTTP Client: Subscription Refresh Method"
        description: "Specify the HTTP method that the probe sends to request a subscription refresh"
        type: "string"
        options:
          - label: "GET"
            value: "GET"
          - label: "POST"
            value: "POST"
          - label: "PUT"
            value: "PUT"
          - label: "PATCH"
            value: "PATCH"
          - label: "DELETE"
            value: "DELETE"
    content:
      __metadata:
        label: "HTTP Client: Subscription Refresh Content"
        description: "Specify any additional information that the probe sends with the subscription refresh request"
        type: "string"
    headers:
      __metadata:
        label: "HTTP Client: Subscription Refresh Headers"
        description: "Specify an HTTP header to send with all subscription refresh requests, overrides the global HTTP header options configured by the httpHeader"
        type: "string"
    interval:
      __metadata:
        label: "HTTP Client: Subscription Refresh Interval"
        description: "Specify the interval (seconds) that the probe leaves between successive subscription refresh requests"
        type: "string"
  keepTokens:
    __metadata:
      label: "HTTP Client: Keep Tokens"
      description: "Specify a comma-separated list of the attributes that the probe extracts from the incoming JSON data"
      type: "string"
  refreshRetryCount:
    __metadata:
      label: "HTTP Client: Refresh Retry Count"
      description: "Specify the maximum number of times that the probes sends a refresh request"
      type: "number"
  securityProtocol:
    __metadata:
      label: "HTTP Client: Security Protocol"
      description: "Specify the security protocol for retrieving of events from the REST API."
      type: "string"


autoscaling:
  __metadata:
    label: "Auto-scaling"
    description: "Probe auto-scaling policy"
  enabled:
    __metadata:
      label: "Enable Horizontal Pod autoscaling"
      description: "Pod will scale based on the autoscaling parameters"
      type: "boolean"
      required: false
  minReplicas:
    __metadata:
      label: "Minimum replicas"
      description: "Minimum number of probe replicas at any point in time"
      type: "number"
      required: false
  maxReplicas:
    __metadata:
      label: "Maximum replicas"
      description: "Maximum number of probe replicas at any point in time"
      type: "number"
      required: false
  cpuUtil:
    __metadata:
      label: "Target CPU utilization"
      description: "Target average CPU utilization (represented as a percentage of requested CPU) over all the pods. Eg: Set to 60 for 60% target utilization." 
      type: "number"
      required: false

poddisruptionbudget:
  __metadata:
    label: "Pod Disruption Budget"
    description: "Pod Disruption Budget. Administrator role or higher is required to enable PDB."
  enabled:
    __metadata:
      label: "Enable Pod Disruption Budget"
      description: "Enables application protection availability during a cluster node maintenance."
      type: "boolean"
      required: false
  minAvailable:
    __metadata:
      label: "Minimum number of replicas"
      description: "Minimum number or percentage of probe replicas that must be available during pod eviction"
      type: "string"
      required: false