# IBM_SHIP_PROLOG_BEGIN_TAG
# *****************************************************************
#
# Licensed Materials - Property of IBM
#
# (C) Copyright IBM Corp. 2018. All Rights Reserved.
#
# US Government Users Restricted Rights - Use, duplication or
# disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
#
# *****************************************************************
# IBM_SHIP_PROLOG_END_TAG
apiVersion: v1
kind: Secret
metadata:
  name: {{ template "shortname" . }}-secrets
  labels:
    {{ include "vision-standard-labels" . | indent 4 }}
    run: {{ template "shortname" . }}-secrets
type: Opaque
data:
  # Mongo DB
  mongodb-admin-password: {{ .Values.poweraiVisionMongodb.mongodbAdminPassword | b64enc | quote }}

  # Rabbitmq
  {{ $rabpwd := default (randAlphaNum 10) .Values.poweraiVisionVideoRabbitmq.rabbitmqPassword }}
  {{ $rabuser := .Values.poweraiVisionVideoRabbitmq.rabbitmqUsername }}
  {{ $rabvhost := .Values.poweraiVisionVideoRabbitmq.rabbitmqVhost }}
  rabbitmq-password: {{ $rabpwd| b64enc | quote }}
  celery_result_backend_video: {{ printf "amqp://%s:%s@%s-video-rabmq:5672/%s" $rabuser $rabpwd (include "shortname" .) $rabvhost | b64enc | quote }}
  celery_result_backend_video_test: {{ printf "amqp://%s:%s@%s-video-test-rabmq:5672/%s" $rabuser $rabpwd (include "shortname" .) $rabvhost | b64enc | quote }}

  # Postgres DB
  {{ if .Values.poweraiVisionPostgres.postgresPassword }}
  postgres-password:  {{ .Values.poweraiVisionPostgres.postgresPassword | b64enc | quote }}
  {{ else }}
  postgres-password: {{ toString "tmppassw0rd" | b64enc | quote }}
  {{ end }}

  # Keycloak
  keycloak-password:  {{ .Values.poweraiVisionKeycloak.keycloakAdminPassword | b64enc | quote }}
