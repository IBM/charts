apiVersion: v1
kind: ConfigMap
metadata:
  name: "{{ .Release.Name }}-store-db-schema-update"
  labels:
    service:   "conversation"
    component: "store_db_schema_updater"
    slot:      "{{ .Release.Name }}"
    app: "ibm-watson-assistant-prod-1.3.0"
    chart: "ibm-watson-assistant"
    heritage: "{{ .Release.Service }}"
    release: "{{ .Release.Name }}"
data:
  gulpfile: |
    'use strict';
    var gulp = require('gulp');
    var pgschema = require('@watson-conversation/gulp-pg-schema');
    if ( '' === (process.env.SCHEMA_VERSION || '')) {
      gulp.task('schema-update', function () {
        return pgschema({schemadir : 'lib/components/db/schema'});
      });
    } else {
      gulp.task('schema-update', function () {
        return pgschema({schemadir : 'lib/components/db/schema', "overrideversion": process.env.SCHEMA_VERSION});
      });
    }
