# We need to have the isIcp flag enabled only for the PPA delivery for rest all the
# secrets needs to be created. The one to skip in PPA is docker registry entry
{{- template "isIcp" . -}}
{{- if not (.Values.isIcp) }}
{{ if eq (.Values.enableBackups|quote|lower) "\"true\"" }}
# S3 ObjectStore secrets (for backups)
apiVersion: v1
kind: Secret
metadata:
  name: s3
  labels:
{{ include "cam.labels" .  | indent 4 }}
type: Opaque
data:
  s3.url: {{ required "secrets.s3Url is required!" .Values.secrets.s3Url | b64enc | quote }}
  s3.access_key_id: {{ required "secrets.s3AccessKeyId is required!" .Values.secrets.s3AccessKeyId | b64enc | quote }}
  s3.secret_access_key: {{ required "secrets.s3SecretAccessKey is required!" .Values.secrets.s3SecretAccessKey | b64enc | quote }}
  encryption_passphrase: {{ required "secrets.backupPassphrase is required!" .Values.secrets.backupPassphrase | b64enc | quote }}
{{ end }}
{{ end }}