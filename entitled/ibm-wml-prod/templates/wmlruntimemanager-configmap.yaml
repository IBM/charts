apiVersion: v1
data:
  ai-function-runtime-config-fvt.json: |-
    {
      "ai-function": {
        "0.1.368": {
          "next_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_mc3_py368_g1_rt.image.repository }}:{{ .Values.wml_runtime_mc3_py368_g1_rt.image.tag }}",
          "os_min_pods": "0",
          "current_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_mc3_py368_g1_rt.image.repository }}:{{ .Values.wml_runtime_mc3_py368_g1_rt.image.tag }}",
          "pythoncommon": "/opt/ibm/scoring/python/conf-common",
          "configvolume": "/opt/ibm/scoring/python/conf-rt",
          "configvolumemap": "wmlscoringaifunc",
          "pythoncommonmap": "wmlscoringpythoncommon"
        },
        "size": {
          "small": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "medium": {
            "memory": "4Gi",
            "cpu": "2"
          },
          "large": {
            "memory": "6Gi",
            "cpu": "2"
          },
          "xlarge": {
            "memory": "8Gi",
            "cpu": "2"
          },
          "batch_small": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "batch_medium": {
            "memory": "4Gi",
            "cpu": "2"
          },
          "batch_large": {
            "memory": "6Gi",
            "cpu": "2"
          }
        },
        "runtime_mapping": {
          "ai-function_0.1": {
          "ai-function_0.1-py3.6": "0.1.368"
          }
        },
        "policy": {
          "cold": {
            "lite": {
              "retention_period": "0"
            },
            "standard": {
              "retention_period": "0"
            },
            "professional": {
              "retention_period": "0"
            },
            "enterprise": {
              "retention_period": "0"
            }
          }
        }
      },
      "status": "SUCCESS",
      "os_default_size": "204800"
    }
  caffe-runtime-config-fvt.json: |-
    {
      "caffe": {
        "1.0": {
          "current_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.tag }}",
          "next_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.tag }}",
          "os_min_pods": "0",
          "configvolume": "/opt/ibm/scoring/python/conf-rt",
          "pythoncommon": "/opt/ibm/scoring/python/conf-common",
          "configvolumemap": "wmlscoringcaffe10",
          "pythoncommonmap": "wmlscoringpythoncommon"
        },
        "size": {
          "small": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "medium": {
            "memory": "4Gi",
            "cpu": "2"
          },
          "large": {
            "memory": "6Gi",
            "cpu": "2"
          },
          "xlarge": {
            "memory": "8Gi",
            "cpu": "2"
          },
          "batch_small": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "batch_medium": {
            "memory": "4Gi",
            "cpu": "2"
          },
          "batch_large": {
            "memory": "6Gi",
            "cpu": "2"
          }
        },
        "runtime_mapping": {
          "caffe_1.0": {
            "caffe_1.0-py3": "1.0"
          }
        },
        "policy": {
          "cold":
          {
            "lite":
            {
              "retention_period": "0"
            },
            "standard":
            {
              "retention_period": "0"
            },
            "professional":
            {
              "retention_period": "0"
            },
            "enterprise":
            {
              "retention_period": "0"
            }

          }
        }
      },
      "status":"NORMAL",
      "os_default_size": "83886080"
    }
  deployment-fvt.yaml: |
    apiVersion: apps/v1beta1
    kind: Deployment
    metadata:
      name: wml-scoring-d1
      namespace: {{ .Release.Namespace }}
    spec:
      revisionHistoryLimit: 3 #keep last 3 rs
      replicas: 1
      selector:
        matchLabels:
          app: wml-scoring
          isDynamic: true
      template:
        metadata:
          labels:
            app: wml-scoring
          annotations:
            productName: IBM Watson Machine Learning
            productID: ICP4D-WML_210_00000
            productVersion: 2.1.0.0
        spec:
          containers:
          - name: runtime-container
            image: "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeMllib2_2.image.repository }}:{{ .Values.wmlRuntimeMllib2_2.image.tag }}"
            envFrom:
            - secretRef:
                name: wml-scoring-svc-secret
            - secretRef:
                name: wdp-service-id
            livenessProbe:
              httpGet:
                path: /v3/scoring/online/heartbeat
                port: 16500
                scheme: HTTPS
              failureThreshold: 10
              initialDelaySeconds: 185
              periodSeconds: 60
              timeoutSeconds: 5
              successThreshold: 1
            readinessProbe:
              httpGet:
                path: /v3/scoring/online/heartbeat
                port: 16500
                scheme: HTTPS
              failureThreshold: 10
              initialDelaySeconds: 180
              periodSeconds: 60
              timeoutSeconds: 5
              successThreshold: 1
            volumeMounts:
            - name: configvolume
              mountPath: "/opt/ibm/scoring/python/conf-rt"
            - name: pythoncommon
              mountPath: "/opt/ibm/scoring/python/conf-common"
            - name: user-home-mount
              mountPath: "/user-home"
            - name: wmlkafka
              mountPath: "/opt/ibm/wml-kafka"
            - name: service-token
              mountPath: "/var/run/secrets/kubernetes.io/serviceaccount"
            - name: internalpubkey
              mountPath: "/etc/pki/ca-trust/source/anchors"
            resources:
              limits:
                cpu: 1
                memory: 256Mi
              requests:
                cpu: 1
                memory: 256Mi
            env:
             - name: WMLENV
               value: fvt
             - name: DATACENTRE
               value: $datacentre
             - name: INSTANCE_ID
               value: instanceid
             - name: INSTANCE_PREFIX
               value: services/wml-online-scoring/instances
             - name: RUNTIME
               value: Spark
             - name: POD_TYPE
               value: INITIAL_POD
             - name: NODE_NUM
               value: 1
             - name: MEMORY
               value: 256Mi
             - name: CPU
               value: 1
             - name: MEMORY_THRESHOLD
               value: "60"
             - name: AGT_SERVICE_GRPC_HOST
               value: localhost:16501
             - name: DEPLOYMENT_TYPE
               value: online_scoring
             - name: WMLNEWRELIC
               value: "DISABLED"
             - name: DEPLOYMENT_PLATFORM
               value: "private"
             - name: DEPLOYMENT_PRIVATE
               value: "local"
             - name: SSL_KEYSTORE_PASSWORD
               value: DUMMY_VALUE
             - name: SSL_TRUSTSTORE_PASSWORD
               value: DUMMY_VALUE
             - name: GRPC_SERVER_KEY
               value: DUMMY_VALUE
             - name: OS_KEY_HEADER_NAME
               value: dummy
             - name: OS_KEY_HEADER_VALUE
               value: dummy
             - name: RUNTIME_SCHEDULER
               value: "ENABLED"
             - name: RUNTIME_SCHEDULER_INTERVAL
               value: "900"
             - name: WS_SERVICE_ID
               value: dummy
             - name: WS_SERVICE_ID_CREDENTIALS
               value: dummy
            ports:
              containerPort: 16500
          volumes:
          - name: configvolume
            configMap:
              name: wmlscoringtf113
          - name: pythoncommon
            configMap:
              name: wmlscoringpythoncommon
          - name: wmlkafka
            configMap:
              name: wmlkafkaconfigmap
          - name: service-token
            configMap:
              name: wmlscoringserviceaccount
          - name: internalpubkey
            secret:
              secretName: internal-nginx-svc-tls
          securityContext:
            runAsUser: 1000320999
          serviceAccountName: {{ .Values.global.editor.sa }}
  hybrid-runtime-config-fvt.json: |-
    {
      "hybrid": {
        "0.1": {
          "current_version":  "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeHybrid.image.repository }}:{{ .Values.wmlRuntimeHybrid.image.tag }}",
          "next_version":  "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeHybrid.image.repository }}:{{ .Values.wmlRuntimeHybrid.image.tag }}",
          "os_min_pods": "0",
          "configvolume": "/opt/ibm/wml-online-scoring/runtimes/hybrid/conf",
          "configvolumemap": "wmlscoringmllib"
        },
        "0.2": {
          "current_version":  "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeHybrid.image.repository }}:{{ .Values.wmlRuntimeHybrid.image.tag }}",
          "next_version":  "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeHybrid.image.repository }}:{{ .Values.wmlRuntimeHybrid.image.tag }}",
          "os_min_pods": "0",
          "configvolume": "/opt/ibm/wml-online-scoring/runtimes/hybrid/conf",
          "configvolumemap": "wmlscoringmllib"
        },
        "size": {
          "small": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "medium": {
            "memory": "4Gi",
            "cpu": "2"
          },
          "large": {
            "memory": "6Gi",
            "cpu": "2"
          },
          "xlarge": {
            "memory": "8Gi",
            "cpu": "2"
          },
          "batch_small": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "batch_medium": {
            "memory": "4Gi",
            "cpu": "2"
          },
          "batch_large": {
            "memory": "6Gi",
            "cpu": "2"
          }
        },
        "policy": {
          "cold":
          {
            "lite":
            {
              "retention_period": "0"
            },
            "standard":
            {
              "retention_period": "0"
            },
            "professional":
            {
              "retention_period": "0"
            },
            "enterprise":
            {
              "retention_period": "0"
            }

          }
        },
        "runtime_mapping": {
        }
      },
      "status":"NORMAL",
      "os_default_size": "83886080"
    }
  keras-runtime-config-fvt.json: |-
    {
      "keras": {
        "2.2.4-tf": {
          "current_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.tag }}",
          "next_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.tag }}",
          "os_min_pods": "0",
          "configvolume": "/opt/ibm/scoring/python/conf-rt",
          "pythoncommon": "/opt/ibm/scoring/python/conf-common",
          "configvolumemap": "wmlscoringtf113",
          "pythoncommonmap": "wmlscoringpythoncommon"
        },
        "2.1.6": {
          "current_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.tag }}",
          "next_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.tag }}",
          "os_min_pods": "0",
          "configvolume": "/opt/ibm/scoring/python/conf-rt",
          "pythoncommon": "/opt/ibm/scoring/python/conf-common",
          "configvolumemap": "wmlscoringtf113",
          "pythoncommonmap": "wmlscoringpythoncommon"
        },
        "2.2.4": {
          "current_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g2_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g2_rt.image.tag }}",
          "next_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g2_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g2_rt.image.tag }}",
          "os_min_pods": "0",
          "configvolume": "/opt/ibm/scoring/python/conf-rt",
          "pythoncommon": "/opt/ibm/scoring/python/conf-common",
          "configvolumemap": "wmlscoringtf114",
          "pythoncommonmap": "wmlscoringpythoncommon"
        },
        "size": {
          "small": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "medium": {
            "memory": "4Gi",
            "cpu": "2"
          },
          "large": {
            "memory": "6Gi",
            "cpu": "2"
          },
          "xlarge": {
            "memory": "8Gi",
            "cpu": "2"
          },
          "batch_small": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "batch_medium": {
            "memory": "4Gi",
            "cpu": "2"
          },
          "batch_large": {
            "memory": "6Gi",
            "cpu": "2"
          }
        },
        "runtime_mapping": {
          "keras_2.1.6": {
            "tensorflow_1.13-py3": "2.1.6",
            "tensorflow_1.13-py3.6": "2.1.6"
          },
          "keras_2.2.4-tf": {
            "tensorflow_1.13-py3": "2.2.4-tf",
            "tensorflow_1.13-py3.6": "2.2.4-tf"
          },
          "keras_2.2.4": {
            "tensorflow_1.14-py3": "2.2.4",
            "tensorflow_1.14-py3.6": "2.2.4"
          }
        },
        "policy": {
          "cold":
          {
            "lite":
            {
              "retention_period": "0"
            },
            "standard":
            {
              "retention_period": "0"
            },
            "professional":
            {
              "retention_period": "0"
            },
            "enterprise":
            {
              "retention_period": "0"
            }

          }
        }
      },
      "status":"NORMAL",
      "os_default_size": "83886080"
    }
  log4j.properties: |
    log4j.rootLogger=INFO,all,STDOUT
    log4j.logger.cluster=INFO
    log4j.logger.security=INFO,securityAppender,STDOUT
    log4j.additivity.security=false
    log4j.logger.org.apache.kafka=ERROR,all
    log4j.logger.org.apache.spark=ERROR,all

    log4j.appender.all=org.apache.log4j.RollingFileAppender
    log4j.appender.all.File=/opt/ibm/wml-online-scoring/runtime-manager/logs/wml-online-scoring-runtime-manager.log
    log4j.appender.all.DatePattern=.yyyy-MM-dd
    log4j.appender.all.layout=org.apache.log4j.PatternLayout
    log4j.appender.all.layout.ConversionPattern=%d{yy/MM/dd HH:mm:ss,SSS}|%t|%-5p|%l|%X{Request-ID}|%m%n
    log4j.logger.com.ibm.ml.scoring.online.ScoringServer=TRACE
    log4j.appender.all.MaxFileSize=5MB
    log4j.appender.all.MaxBackupIndex=5
    log4j.logger.akka=TRACE

    log4j.appender.STDOUT=org.apache.log4j.ConsoleAppender
    log4j.appender.STDOUT.layout=org.apache.log4j.PatternLayout
    log4j.appender.STDOUT.Target=System.out
    log4j.appender.STDOUT.layout.ConversionPattern=%d{yy/MM/dd HH:mm:ss,SSS}|%t|%-5p|%l|%X{Request-ID}|%m%n


    log4j.appender.securityAppender=org.apache.log4j.RollingFileAppender
    log4j.appender.securityAppender.File=/opt/ibm/wml-online-scoring/runtime-manager/logs/security-online-scoring-service.log
    log4j.appender.all.DatePattern=.yyyy-MM-dd
    log4j.appender.securityAppender.layout=org.apache.log4j.PatternLayout
    log4j.appender.securityAppender.layout.ConversionPattern=%d{yy/MM/dd HH:mm:ss,SSS}|%t|%-5p|%l|%X{Request-ID}|%m%n
    log4j.appender.securityAppender.MaxFileSize=5MB
    log4j.appender.securityAppender.MaxBackupIndex=2

    #log4j.appender.cluster-events-appender=org.apache.log4j.DailyRollingFileAppender
    #log4j.appender.cluster-events-appender.File=/temp/scoring-cluster-events.log
    #log4j.appender.cluster-events-appender.DatePattern=.yyyy-MM-dd
    #log4j.appender.cluster-events-appender.layout=org.apache.log4j.PatternLayout
    #log4j.appender.cluster-events-appender.layout.ConversionPattern=%d{yy/MM/dd HH:mm:ss,SSS}|%-5p|%l|%X{Request-ID}|%m%n
  logback.xml: |-
    <?xml version="1.0" encoding="UTF-8" ?>
    <configuration>
        <appender name="STDOUT" class="ch.qos.logback.core.ConsoleAppender">
            <encoder>
                <pattern>%d{HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n</pattern>
            </encoder>
        </appender>

        <root level="INFO">
            <appender-ref ref="STDOUT"/>
        </root>

        <logger name="com.ning.http.client" level="WARN"/>
    </configuration>
  mllib-runtime-config-fvt.json: |
    {
      "mllib": {
        "2.2": {
          "current_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeMllib2_2.image.repository }}:{{ .Values.wmlRuntimeMllib2_2.image.tag }}",
          "next_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeMllib2_2.image.repository }}:{{ .Values.wmlRuntimeMllib2_2.image.tag }}",
          "os_min_pods": "0",
          "configvolume": "/opt/ibm/wml-online-scoring/runtimes/spark-2.1/conf",
          "configvolumemap": "wmlscoringmllib"
        },
        "2.3": {
          "current_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeMllib2_3.image.repository }}:{{ .Values.wmlRuntimeMllib2_3.image.tag }}",
          "next_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeMllib2_3.image.repository }}:{{ .Values.wmlRuntimeMllib2_3.image.tag }}",
          "os_min_pods": "0",
          "configvolume": "/opt/ibm/wml-online-scoring/runtimes/spark-2.1/conf",
          "configvolumemap": "wmlscoringmllib"
        },
        "size": {
          "small": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "medium": {
            "memory": "4Gi",
            "cpu": "2"
          },
          "large": {
            "memory": "6Gi",
            "cpu": "2"
          },
          "xlarge": {
            "memory": "8Gi",
            "cpu": "2"
          },
          "batch_small": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "batch_medium": {
            "memory": "4Gi",
            "cpu": "2"
          },
          "batch_large": {
            "memory": "6Gi",
            "cpu": "2"
          }
        },
        "runtime_mapping": {
        },
        "policy": {
          "cold": {
            "lite": {
              "retention_period": "0"
            },
            "standard": {
              "retention_period": "0"
            },
            "professional": {
              "retention_period": "0"
            },
            "enterprise": {
              "retention_period": "0"
            }
          }
        }
      },
      "status": "NORMAL",
      "os_default_size": "204800"
    }
  runtimeManager.conf: |
    akka {
      loggers = ["akka.event.slf4j.Slf4jLogger"]
      loglevel = "INFO"

      log-dead-letters = 10
      log-dead-letters-during-shutdown = on
      # log-config-on-start = on
      http.server.request-timeout = 120 s
      http.server.idle-timeout = 121 s
      http.server.parsing.max-content-length = 100m

      actor {
        default-dispatcher {
          default-executor {
            fallback: "fork-join-executor"
          }
          executor = "fork-join-executor"
          fork-join-executor {
            parallelism-min = 4
            parallelism-factor = 64
            parallelism-max = 128
            throughput = 1
          }
        }
      }

      scoring-main-dispatcher {
        type = "Dispatcher"
        executor = "fork-join-executor"
        fork-join-executor {
          parallelism-min = 8
          parallelism-factor = 64
          parallelism-max = 128
          throughput = 1
        }
      }

      scoring-jobs-dispatcher {
        type = "Dispatcher"
        executor = "fork-join-executor"
        fork-join-executor {
          parallelism-min = 8
          parallelism-factor = 64
          parallelism-max = 128
          throughput = 1
        }
      }

      scoring-deployments-dispatcher {
        type = "Dispatcher"
        executor = "fork-join-executor"
        fork-join-executor {
          parallelism-min = 8
          parallelism-factor = 64
          parallelism-max = 128
          throughput = 1
        }
      }

      http.host-connection-pool {
        # The maximum number of open requests accepted into the pool across all
        # materializations of any of its client flows.
        # Protects against (accidentally) overloading a single pool with too many client flow materializations.
        # Note that with N concurrent materializations the max number of open request in the pool
        # will never exceed N * max-connections * pipelining-limit.
        # Must be a power of 2 and > 0!
        max-open-requests = 256
        max-connections = 64
      }
    }

    service {

      # Runtime configuration and runtime deployment template
      runtime_config = "/opt/ibm/wml-online-scoring/runtime-manager/conf"
      runtime_template = "/opt/ibm/wml-online-scoring/runtime-manager/conf/deployment-fvt.yaml"
      runtime_environment = "fvt"
      kube_cluster_timeout = 120
      kube_cluster_creation_timeout = 600

      # Config for Validate Token connection
      validateTokenService {
        // public key may be provided via file or url
        ml.pubkey.path = "/opt/ibm/wml-online-scoring/runtime-manager/keys/mltoken.pub"
        icp.pubkey.path = "/user-home/_global_/config/jwt/public.pem"
      }

      ml_repository {
        url = "https://internal-nginx-svc:12443"
        spacesGetLimit = 50
      }

      wmlService {
        url = "https://internal-nginx-svc:12443"
        timeout = 60
        icpport = "31843"
      }

      envoy {
        url = "https://wml-os-envoy:32006"
      }

      replication.factor = 2
      //  http.service.interface = "localhost"
      http.service.port = 16500

      enable-ssl = true

      ssl {
        port = 16500
        keystore {
          path = "/opt/ibm/wml-online-scoring/runtime-manager/keys/private/keystore.jks"
          type = "JKS"
        }
      }

      runtime_manager {
        deployment {
          lock_delay = 15 //Minutes
        }
      }

      resiliency {
        delay = 500   // In millisecodns
        retries = 3
      }

      iam {
        url = "dummy"
        pdp {
          serviceName = "pm-20-dev"
          apiKey = ""
        }
      }

      kube-config {
        job.activeDeadlineSeconds = 900
      }

      wml_instances {
        url = "https://wml-fvt.ml.test.cloud.ibm.com/v3/wml_instances"
      }

      features {
        list = ["SPACES"]
      }

      space_access {
        post = ["Admin", "Editor"]
        get = ["Admin", "Editor", "Viewer"]
        patch = ["Admin", "Editor"]
        delete = ["Admin", "Editor"]

      }

      ml-event-client {
        topicSpace = "misc"
        messageProcessParallelism = 20
        v4TopicSpace = "deployments"
      }

      batchapp.jar {
        name2_3 = "/opt/ibm/third-party/libs/batch/wml-online-scoring-runner-hummingbird.jar"
        mainclass = "com.ibm.analytics.wml.batch_deploy.runner.application.BatchApp"
      }

      hummingbird {
        url_base = "https://internal-nginx-svc:12443/ae/"
        url_suffix = "/v2/jobs"
      }

      rolling-update {
        maxThreadsRollingUpdate = 10
        maxWaitSingleTenant = 1000
        maxWaitMultiTenant = 2000
      }

      async_persistant_storage.base_dir = "/manager-pvc"

      virtual_deployment {
        images {
          scikit_learn_0_20 = "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.tag }}"
          xgboost_0_82 = "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.tag }}"
        }
      }

      rabbitmq {
        subscriber.timeout.seconds = 10
        exchange = "scoring-fvt"
        queue_expiration_hours = 24
        threadpool.size = 50
        queues = ["non-do-job-queue", "do-job-queue"]
        do_queue_name = "do-job-queue"
        non_do_queue_name = "non-do-job-queue"
        routing_keys = ["non_do_routing_key", "do_routing_key"]
        do_queue_routing_key = "do_routing_key"
        non_do_queue_routing_key = "non_do_routing_key"
      }

      jobs_thread {
        post_factor = 50
      }

      aios {
          skip_list = []
      }

      pod_spawn {
        memory_factor = 0.7
        deploy_by_number = true
      }

      etcd_fetch_limit = 1200
      one_node {
        pod_cleanup {
          delay_interval = 900
          interval = 1200
        }
      }

      autoai {
         kb {
           image_tag = "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlAutoaiKB.image.repository }}:"
         }
      }

    }

    grpc {
      service {
        agent_interface = "wml-scoring-rt-utils"
        agent_port = 16502
      }
    }
  scikit-runtime-config-fvt.json: |
    {
        "scikit-learn": {
          "0.20": {
            "current_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.tag }}",
            "next_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.tag }}",
            "os_min_pods": "0",
            "configvolume": "/opt/ibm/scoring/python/conf-rt",
            "pythoncommon": "/opt/ibm/scoring/python/conf-common",
            "configvolumemap": "wmlscoringsklearn20",
            "pythoncommonmap": "wmlscoringpythoncommon"
          },
          "size": {
            "xsmall": {
              "memory": "2Gi",
              "cpu": "2"
            },
            "small": {
              "memory": "2Gi",
              "cpu": "2"
            },
            "medium": {
              "memory": "4Gi",
              "cpu": "2"
            },
            "large": {
              "memory": "6Gi",
              "cpu": "2"
            },
            "xlarge": {
              "memory": "8Gi",
              "cpu": "2"
            },
            "batch_small": {
              "memory": "2Gi",
              "cpu": "2"
            },
            "batch_medium": {
              "memory": "4Gi",
              "cpu": "2"
            },
            "batch_large": {
              "memory": "6Gi",
              "cpu": "2"
            }
          },
          "runtime_mapping": {
            "scikit-learn_0.20": {
              "scikit-learn_0.20-py3": "0.20",
              "scikit-learn_0.20-py3.6": "0.20",
              "xgboost_0.82-py3": "0.20",
              "xgboost_0.82-py3.6": "0.20"
            },
            "xgboost_0.82": {
              "xgboost_0.82-py3": "0.20",
              "xgboost_0.82-py3.6": "0.20"
            }
          },
          "policy": {
            "cold":
            {
              "lite":
              {
                "retention_period": "0"
              },
              "standard":
              {
                "retention_period": "0"
              },
              "professional":
              {
                "retention_period": "0"
              },
              "enterprise":
              {
                "retention_period": "0"
              }

            }
          }
        },
      "status":"NORMAL",
      "os_default_size": "204800"
    }
  spss-modeler-runtime-config-fvt.json: |
    {
      "spss-modeler": {
        "18.1": {
          "current_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeSpss.image.repository }}:{{ .Values.wmlRuntimeSpss.image.tag }}",
          "next_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeSpss.image.repository }}:{{ .Values.wmlRuntimeSpss.image.tag }}",
          "os_min_pods": "0",
          "configvolume": "/opt/ibm/mlonlinespss/conf",
          "configvolumemap": "wmlscoringspss"
        },
        "17.1": {
          "current_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeSpss.image.repository }}:{{ .Values.wmlRuntimeSpss.image.tag }}",
          "next_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeSpss.image.repository }}:{{ .Values.wmlRuntimeSpss.image.tag }}",
          "os_min_pods": "0",
          "configvolume": "/opt/ibm/mlonlinespss/conf",
          "configvolumemap": "wmlscoringspss"
        },
        "batch": {
          "current_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeSpssBatch.image.repository }}:{{ .Values.wmlRuntimeSpssBatch.image.tag }}",
          "next_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeSpssBatch.image.repository }}:{{ .Values.wmlRuntimeSpssBatch.image.tag }}",
           "configvolume":"/opt/ibm/mlonlinespss/conf",
           "os_min_pods":"0",
            "configvolumemap":"wmlscoringspss"
        },
        "size": {
          "small": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "medium": {
            "memory": "4Gi",
            "cpu": "2"
          },
          "large": {
            "memory": "6Gi",
            "cpu": "2"
          },
          "xlarge": {
            "memory": "8Gi",
            "cpu": "2"
          },
          "batch_small": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "batch_medium": {
            "memory": "4Gi",
            "cpu": "2"
          },
          "batch_large": {
            "memory": "6Gi",
            "cpu": "2"
          }
        },
        "runtime_mapping": {
        },
        "policy": {
          "cold":
          {
            "lite":
            {
              "retention_period": "0"
            },
            "standard":
            {
              "retention_period": "0"
            },
            "professional":
            {
              "retention_period": "0"
            },
            "enterprise":
            {
              "retention_period": "0"
            }

          }
        }
      },
      "status": "NORMAL",
      "os_default_size": "0"
    }
  do-runtime-config-fvt.json: |
    {
      "do": {
        "12.9": {
          "current_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeDO.image.repository }}:{{ .Values.wmlRuntimeDO.image.tag }}",
          "next_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeDO.image.repository }}:{{ .Values.wmlRuntimeDO.image.tag }}",
          "os_min_pods": "0",
          "configvolume": "/opt/ibm/wml-online-scoring/runtimes/do/conf",
          "configvolumemap": "wmlscoringdo"
        },        
        "size": {
          "small": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "medium": {
            "memory": "4Gi",
            "cpu": "2"
          },
          "large": {
            "memory": "6Gi",
            "cpu": "2"
          },
          "xlarge": {
            "memory": "8Gi",
            "cpu": "2"
          },
          "batch_small": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "batch_medium": {
            "memory": "4Gi",
            "cpu": "2"
          },
          "batch_large": {
            "memory": "6Gi",
            "cpu": "2"
          }
        },
        "runtime_mapping": {
        },
        "policy": {
          "cold":
          {
            "lite":
            {
              "retention_period": "0"
            },
            "standard":
            {
              "retention_period": "0"
            },
            "professional":
            {
              "retention_period": "0"
            },
            "enterprise":
            {
              "retention_period": "0"
            }

          }
        }
      },
      "status": "NORMAL",
      "os_default_size": "0"
    }    
  tensorflow-runtime-config-fvt.json: |-
    {
      "tensorflow": {
        "1.14": {
          "current_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g2_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g2_rt.image.tag }}",
          "next_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g2_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g2_rt.image.tag }}",
          "os_min_pods": "0",
          "configvolume": "/opt/ibm/scoring/python/conf-rt",
          "pythoncommon": "/opt/ibm/scoring/python/conf-common",
          "configvolumemap": "wmlscoringtf114",
          "pythoncommonmap": "wmlscoringpythoncommon"
        },
        "1.13": {
          "current_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.tag }}",
          "next_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.tag }}",
          "os_min_pods": "0",
          "configvolume": "/opt/ibm/scoring/python/conf-rt",
          "pythoncommon": "/opt/ibm/scoring/python/conf-common",
          "configvolumemap": "wmlscoringtf113",
          "pythoncommonmap": "wmlscoringpythoncommon"
        },
        "size": {
          "xsmall": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "small": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "medium": {
            "memory": "4Gi",
            "cpu": "2"
          },
          "large": {
            "memory": "6Gi",
            "cpu": "2"
          },
          "xlarge": {
            "memory": "8Gi",
            "cpu": "2"
          },
          "batch_small": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "batch_medium": {
            "memory": "4Gi",
            "cpu": "2"
          },
          "batch_large": {
            "memory": "6Gi",
            "cpu": "2"
          }
        },
        "runtime_mapping": {
            "tensorflow_1.13": {
              "tensorflow_1.13-py3": "1.13",
              "tensorflow_1.13-py3.6": "1.13"
            },
            "tensorflow_1.14": {
              "tensorflow_1.14-py3": "1.14",
              "tensorflow_1.14-py3.6": "1.14"
            }
        },
        "policy": {
          "cold":
          {
            "lite":
            {
              "retention_period": "0"
            },
            "standard":
            {
              "retention_period": "0"
            },
            "professional":
            {
              "retention_period": "0"
            },
            "enterprise":
            {
              "retention_period": "0"
            }

          }
        }
      },
      "status":"NORMAL",
      "os_default_size": "83886080"
    }
  pytorch-onnx-runtime-config-fvt.json: |-
    {
      "pytorch-onnx": {
        "1.0": {
          "current_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.tag }}",
          "next_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.tag }}",
          "os_min_pods": "0",
          "configvolume": "/opt/ibm/scoring/python/conf-rt",
          "pythoncommon": "/opt/ibm/scoring/python/conf-common",
          "configvolumemap": "wmlscoringpytorchonnx10",
          "pythoncommonmap": "wmlscoringpythoncommon"
        },
        "1.1": {
          "current_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g2_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g2_rt.image.tag }}",
          "next_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g2_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g2_rt.image.tag }}",
          "os_min_pods": "0",
          "configvolume": "/opt/ibm/scoring/python/conf-rt",
          "pythoncommon": "/opt/ibm/scoring/python/conf-common",
          "configvolumemap": "wmlscoringpytorchonnx11",
          "pythoncommonmap": "wmlscoringpythoncommon"
        },
        "size": {
          "xsmall": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "small": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "medium": {
            "memory": "4Gi",
            "cpu": "2"
          },
          "large": {
            "memory": "6Gi",
            "cpu": "2"
          },
          "xlarge": {
            "memory": "8Gi",
            "cpu": "2"
          },
          "batch_small": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "batch_medium": {
            "memory": "4Gi",
            "cpu": "2"
          },
          "batch_large": {
            "memory": "6Gi",
            "cpu": "2"
          }
        },
        "policy": {
          "cold":
          {
            "lite":
            {
              "retention_period": "0"
            },
            "standard":
            {
              "retention_period": "0"
            },
            "professional":
            {
              "retention_period": "0"
            },
            "enterprise":
            {
              "retention_period": "0"
            }

          }
        },
        "runtime_mapping": {
          "pytorch-onnx_1.0": {
            "pytorch-onnx_1.0-py3": "1.0",
            "pytorch-onnx_1.0-py3.6": "1.0",
            "pytorch_1.0-py3": "1.0",
            "pytorch_1.0-py3-edt": "1.0"
          },
          "pytorch-onnx_1.1": {
              "pytorch-onnx_1.1-py3.6": "1.1",
              "pytorch-onnx_1.1-py3.6-edt": "1.1"
          }
        }
      },
      "status":"NORMAL",
      "os_default_size": "83886080"
    }
  wml-runtime-config-fvt.json: |
    {
        "wml": {
          "1.6": {
            "current_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeMllib2_2.image.repository }}:{{ .Values.wmlRuntimeMllib2_2.image.tag }}",
            "next_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeMllib2_2.image.repository }}:{{ .Values.wmlRuntimeMllib2_2.image.tag }}",
            "os_min_pods": "0",
            "configvolume": "/opt/ibm/wml-online-scoring/runtimes/spark-2.1/conf",
            "configvolumemap": "wmlscoringmllib"
          },
          "2.0": {
            "current_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeMllib2_2.image.repository }}:{{ .Values.wmlRuntimeMllib2_2.image.tag }}",
            "next_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeMllib2_2.image.repository }}:{{ .Values.wmlRuntimeMllib2_2.image.tag }}",
            "os_min_pods": "0",
            "configvolume": "/opt/ibm/wml-online-scoring/runtimes/spark-2.1/conf",
            "configvolumemap": "wmlscoringmllib"
          },
          "2.1": {
            "current_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeMllib2_2.image.repository }}:{{ .Values.wmlRuntimeMllib2_2.image.tag }}",
            "next_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wmlRuntimeMllib2_2.image.repository }}:{{ .Values.wmlRuntimeMllib2_2.image.tag }}",
            "os_min_pods": "0",
            "configvolume": "/opt/ibm/wml-online-scoring/runtimes/spark-2.1/conf",
            "configvolumemap": "wmlscoringmllib"
          },
          "size": {
            "small": {
              "memory": "2Gi",
              "cpu": "2"
            },
            "medium": {
              "memory": "4Gi",
              "cpu": "2"
            },
            "large": {
              "memory": "6Gi",
              "cpu": "2"
            },
            "xlarge": {
              "memory": "8Gi",
              "cpu": "2"
            },
            "batch_small": {
              "memory": "2Gi",
              "cpu": "2"
            },
            "batch_medium": {
              "memory": "4Gi",
              "cpu": "2"
            },
            "batch_large": {
              "memory": "6Gi",
              "cpu": "2"
            }
          },
          "runtime_mapping": {
          },
          "policy": {
            "cold":
            {
              "lite":
              {
                "retention_period": "0"
              },
              "standard":
              {
                "retention_period": "0"
              },
              "professional":
              {
                "retention_period": "0"
              },
              "enterprise":
              {
                "retention_period": "0"
              }

            }
          }
        },
      "status":"NORMAL",
      "os_default_size": "0"
    }
  t-shirt-size-config-fvt.json: |-
    {
      "XS" :{
        "vCPU": "1",
        "RAM": "1"
      },
      "S" :{
        "vCPU": "2",
        "RAM": "2"
      },
      "M" :{
        "vCPU": "2",
        "RAM": "4"
      },
      "L" :{
        "vCPU": "2",
        "RAM": "6"
      },
      "XL" :{
        "vCPU": "2",
        "RAM": "8"
      }
    }
  xgboost-runtime-config-fvt.json: |-
    {
      "xgboost": {
        "0.82": {
          "current_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.tag }}",
          "next_version": "{{ .Values.global.docker_registry_prefix }}/{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.repository }}:{{ .Values.wml_runtime_ac201903_py368_g1_rt.image.tag }}",
          "os_min_pods": "0",
          "configvolume": "/opt/ibm/scoring/python/conf-rt",
          "pythoncommon": "/opt/ibm/scoring/python/conf-common",
          "configvolumemap": "wmlscoringsklearn20",
          "pythoncommonmap": "wmlscoringpythoncommon"
        },
        "size": {
          "small": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "medium": {
            "memory": "4Gi",
            "cpu": "2"
          },
          "large": {
            "memory": "6Gi",
            "cpu": "2"
          },
          "xlarge": {
            "memory": "8Gi",
            "cpu": "2"
          },
          "batch_small": {
            "memory": "2Gi",
            "cpu": "2"
          },
          "batch_medium": {
            "memory": "4Gi",
            "cpu": "2"
          },
          "batch_large": {
            "memory": "6Gi",
            "cpu": "2"
          }
        },
        "runtime_mapping": {
        },
        "policy": {
          "cold":
          {
            "lite":
            {
              "retention_period": "0"
            },
            "standard":
            {
              "retention_period": "0"
            },
            "professional":
            {
              "retention_period": "0"
            },
            "enterprise":
            {
              "retention_period": "0"
            }

          }
        }
      },
      "status":"NORMAL",
      "os_default_size": "0"
    }
kind: ConfigMap
metadata:
  name: wmlruntimemanager
  labels:
    app: wml-os-manager
    chart: "{{ .Chart.Name }}"
    release: "{{ .Release.Name }}"
    heritage: "{{ .Release.Service }}"

