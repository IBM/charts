{{ if .Values.istio.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "execution.fullname" . }}-istio
  labels:
{{ include "execution.labels" . | indent 4 }}
data:
  istio.yml: |+
    virtualization:
      namespaces:
  {{- if .Values.istio.namespaces -}}
    {{- if kindIs "slice" .Values.istio.namespaces -}}
      {{- range .Values.istio.namespaces -}}
        {{- if . -}}
          {{- trim . | toYaml | printf "- %s" | nindent 6 -}}
        {{- end -}}
      {{- end -}}
    {{- else -}}
      {{- trim .Values.istio.namespaces | toYaml | printf "- %s" | nindent 6 -}}
    {{- end -}}
  {{- end -}}
{{- end -}}
