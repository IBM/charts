###############################################################################
# Licensed Materials - Property of IBM.
# Copyright IBM Corporation 2018. All Rights Reserved.
# U.S. Government Users Restricted Rights - Use, duplication or disclosure
# restricted by GSA ADP Schedule Contract with IBM Corp.
#
# Contributors:
#  IBM Corporation - initial API and implementation
###############################################################################
arch:
  __metadata:
    label: "Architecture scheduling preferences"
    description: "Architecture scheduling preferences among amd64 and power"
  amd64:
    __metadata:
      name: "amd64"
      label: "Scheduling preference - amd64"
      description: "Architecture preference for target worker node."
      type: "string"
      immutable: false
      required: true
      options:
      - label: "0 - Do not use"
        value: "0 - Do not use"
      - label: "1 - Least preferred"
        value: "1 - Least preferred"
      - label: "2 - No preference"
        value: "2 - No preference"
      - label: "3 - Most preferred"
        value: "3 - Most preferred"

postgres:
  __metadata:
    label: "Postgres image configuration"
    description: "configurations for postgres image used in this chart"
  image:
    name:
      __metadata:
        label: "Postgres image name"
        name: "name"
        description: "Docker image to pull for postgres."
        type: "string"
        immutable: false
        required: true
    tag:
      __metadata:
        label: "Postgres image Tag"
        name: "tag"
        description: "Docker image tag to pull for postgres."
        type: "string"
        immutable: false
        required: true

creds:
  __metadata:
    label: "creds job image configuration"
    description: configurations for image used in creds job"
  image:
    name:
      __metadata:
        label: "creds job image name"
        name: "name"
        description: "Docker image name to pull for creds image."
        type: "string"
        immutable: false
        required: true
    tag:
      __metadata:
        label: "creds job image tag"
        name: "tag"
        description: "Docker image tag to pull for creds image."
        type: "string"
        immutable: false
        required: true

global:
  __metadata:
    label: "Global Image configuration"
    name: "global"
    description: "Global image configuration that applies for all images"
  image:
    repository:
      __metadata:
        name: "Repository"
        label: "Docker Registry"
        description: "Name of the Docker registry that is used globally in the chart"
        type: "string"
        required: true
    pullSecret:
      __metadata:
        name: "image secret name"
        label: "image secret name"
        description: "name of the secret that is used globally in the chart"
        type: "string"
        immutable: false
        required: true
    pullPolicy:
      __metadata:
        label: "Docker image pull policy"
        description: "Always, Never, or IfNotPresent. Defaults to IfNotPresent"
        type: "string"
        required: true
        options:
        - label: "IfNotPresent"
          value: "IfNotPresent"
        - label: "Always"
          value: "Always"
        - label: "Never"
          value: "Never"
  sch:
    enabled:
      __metadata:
        name: "sch subchart"
        label: "ibm-sch subchart is used"
        description: "Set to false only is upstream chart provides ibm-sch chart"
        type: "boolean"
        hidden: false

clusterName:
  __metadata:
    label: "Cluster name"
    name: "clusterName"
    description: "Postgres Stolon Cluster name to be used"
    type: "string"
    immutable: false
    required: false

debug:
  __metadata:
    label: "Enable Debug"
    name: "debug"
    description: "Enable Debug mode to print debug logs"
    type: "boolean"
    immutable: false
    required: true

slowQueries:
  __metadata:
    label: "Slow Queries"
    description: "configuration for slow queries"
  enabled:
    __metadata:
      label: "Enable Slow Queries"
      name: "slowQueries"
      description: "Enable Debug mode to print debug logs"
      type: "boolean"
      immutable: false
      required: true
  minDuration:
    __metadata:
      label: "Minimum Duration"
      name: "minDuration"
      description: "minimum duration for slow Queries"
      type: "number"
      immutable: false
      required: true

ports:
  __metadata:
    label: "Ports"
    description: "Ports for keeper service"
  internalPort:
    __metadata:
      name: "internalPort"
      label: "Internal port"
      description: "Internal port to be used in Postgres keeper containers, default is 5432"
      type: "number"
      required: true
  externalPort:
    __metadata:
      name: "externalPort"
      label: "External port"
      description: "External port to be used in Postgres keeper service, default is 5432"
      type: "number"
      required: true

maxConnections:
 __metadata:
  label: "Maximum Connections"
  name: "maxConnections"
  description: "Connection Limit, maximum number of client connections that can exist"
  type: "number"
  immutable: false
  required: true

store:
  __metadata:
    label: "Store configuration"
    description: "Stolon store configuration used by the chart"
  backend:
    __metadata:
      name: "backend"
      label: "Backend"
      description: "provide backend for stolon postgres store, default is kubernetes"
      type: "string"
      immutable: false
      required: true
  endpoints:
    __metadata:
      name: "endpoints"
      label: "Endpoints"
      description: "provide Endpoints for stolon postgres store, default is empty"
      type: "string"
      immutable: false
      required: false
  kubeResourceKind:
    __metadata:
      name: "kubeResourceKind"
      label: "Kube resource kind"
      description: "provide Kube resource kind for stolon postgres store, default is configmap"
      type: "string"
      immutable: false
      required: false

auth:
  __metadata:
    label: "Authentication Details"
    description: "configuration for authentication"
  pgReplUsername:
    __metadata:
      name: "pgReplUsername"
      label: "postgres repl user name"
      description: "provide username for repluser, default is pgrepluser"
      type: "string"
      immutable: false
      required: true

  pgSuperuserName:
    __metadata:
      name: "pgSuperuserName"
      label: "postgres super user name"
      description: "provide postgres super user name, default is stolon"
      type: "string"
      immutable: false
      required: true

  authSecretName:
    __metadata:
      name: "authSecretName"
      label: "Secret Name holding passwords "
      description: "Name of an existing secret that has pg_repl_password and pg_su_password"
      type: "string"
      immutable: false
      required: false

keep:
  __metadata:
    label: "Do not remove postgresql on helm delete."
    description: "If enabled helm delete will preserve postgresql database server (the chart) running in kubernetes. Defaults to false."
    type: "boolean"
    required: false

sentinel:
  __metadata:
    label: "Sentinel pods configuration"
    description: "configuration for sentinel pods"
  replicas:
    __metadata:
      name: "replicas"
      label: "sentinel replicas"
      description: "Number of server replicas to deploy. Defaults to 3"
      type: "number"
      immutable: false
      required: true

  tolerations:
    __metadata:
      label: "Tolerations"
      description: "JSON Array Format. (for sentinel pods)"
      type: "string"
      required: false

  resources:
    requests:
      cpu:
        __metadata:
          label: "CPU request"
          description: "The requested CPU"
          type: "string"
          required: true
      memory:
        __metadata:
          label: "Memory request"
          description: "The memory request"
          type: "string"
          required: true
    limits:
      cpu:
        __metadata:
          label: "CPU limit"
          description: "The CPU limit"
          type: "string"
          required: true
      memory:
        __metadata:
          label: "Memory limit"
          description: "The memory limit"
          type: "string"
          required: true

proxy:
  __metadata:
    label: "Proxy configuration"
    description: "configuration for proxy pods"
  replicas:
    __metadata:
      name: "replicas"
      label: "proxy replicas"
      description: "Number of proxy replicas to deploy. Defaults to 3"
      type: "number"
      immutable: false
      required: true

  serviceType:
    __metadata:
      name: "serviceType"
      label: "Service type "
      description: "kubernetes service type to be created for proxy service"
      immutable: false
      required: true
      options:
        - label: "ClusterIP"
          value: "ClusterIP"
        - label: "NodePort"
          value: "NodePort"

  tolerations:
    __metadata:
      label: "Tolerations"
      description: "JSON Array Format. (for proxy pods)"
      type: "string"
      required: false

  listenAddress:
    __metadata:
      name: "listenAddress"
      label: "Listen IP address"
      description: "Listen IP address, default is 0.0.0.0"
      type: "string"
      immutable: false
      required: true

  resources:
    requests:
      cpu:
        __metadata:
          label: "CPU request"
          description: "The requested CPU"
          type: "string"
          required: true
      memory:
        __metadata:
          label: "Memory request"
          description: "The memory request"
          type: "string"
          required: true
    limits:
      cpu:
        __metadata:
          label: "CPU limit"
          description: "The CPU limit"
          type: "string"
          required: true
      memory:
        __metadata:
          label: "Memory limit"
          description: "The memory limit"
          type: "string"

tls:
  __metadata:
    label: "TLS"
    description: "configurations for TLS"
  enabled:
    __metadata:
      label: "Enable TLS"
      description: "To enable TLS for client and management connections set this to true, when true, you MUST also specify tls cert,key and CA bundle information"
      type: "boolean"
      required: true
  tlsSecretName:
    __metadata:
      name: "tlsSecretName"
      label: "Secret Name holding tls certs "
      description: "Name of an existing secret that has tls certs"
      type: "string"
      immutable: false
      required: false

securityContext:
  __metadata:
    label: "Securitycontext configuration"
    description: "Security context configuration for all containers and pods"
  postgres:
    runAsUser:
      __metadata:
        label: "Runasuser"
        description: "Run as user config for the postgres contianers"
        type: "number"
        required: false
    runAsGroup:
      __metadata:
        label: "Runasgroup"
        description: "Run as group config for the postgres contianers"
        type: "number"
        required: false
  creds:
    runAsUser:
      __metadata:
        label: "Runasuser"
        description: "Run as user config for the containers creds gen and creds clean up"
        type: "number"
        required: false


keeper:
  __metadata:
    label: "Keeper configuration"
    description: "Keeper pods configuration"
  replicas:
    __metadata:
      name: "replicas"
      label: "keeper replicas"
      description: "Number of keeper replicas to deploy. Defaults to 3"
      type: "number"
      immutable: false
      required: true

  serviceType:
    __metadata:
      name: "serviceType"
      label: "Service type "
      description: "kubernetes service type to be created for keeper service"
      immutable: false
      required: true
      options:
        - label: "ClusterIP"
          value: "ClusterIP"
        - label: "NodePort"
          value: "NodePort"

  tolerations:
    __metadata:
      label: "Tolerations"
      description: "JSON Array Format. (for keeper pods)"
      type: "string"
      required: false

  resources:
    requests:
      cpu:
        __metadata:
          label: "CPU request"
          description: "The requested CPU"
          type: "string"
          required: true
      memory:
        __metadata:
          label: "Memory request"
          description: "The memory request"
          type: "string"
          required: true
    limits:
      cpu:
        __metadata:
          label: "CPU limit"
          description: "The CPU limit"
          type: "string"
          required: true
      memory:
        __metadata:
          label: "Memory limit"
          description: "The memory limit"
          type: "string"

persistence:
  __metadata:
    label: "Persistent Volume configuration"
    description: "Configures persistence of the data and configuration of Persistent Volume and PV Claim"
  enabled:
    __metadata:
      name: "enabled"
      label: "Enable Persistent Volume"
      description: "Enable Persistent Volume, true or false"
      type: "boolean"
      immutable: false
      required: true
  useDynamicProvisioning:
    __metadata:
      label: "Enable Dynamic bind of Persistent Volumes"
      description: "Enables dynamic bind of Persistent Volumes to created Persisten Volume claims. Defaults to true"
      type: "boolean"
      required: true
  accessMode:
    __metadata:
      name: "accessMode"
      label: "Persistent Volume Access Mode"
      description: "The mode in which persistent volume should be accessed"
      immutable: false
      required: true
      options:
        - label: "ReadWriteOnce"
          value: "ReadWriteOnce"
#        - label: "ReadOnlyMany"
#          value: "ReadOnlyMany"
        - label: "ReadWriteMany"
          value: "ReadWriteMany"

  storageClassName:
    __metadata:
      name: "storageClassName"
      label: "Storage Class Name"
      description: "The name of StorageClass to be used to create persistent volume claim"
      type: "string"
      immutable: false

  size:
    __metadata:
      name: "size"
      label: "PV Storage Size"
      description: "Storage Size for persistent volume to be created"
      type: "string"
      immutable: false
      required: true

dataPVC:
  __metadata:
    label: "Persistent Volume Claim Configuration"
    description: "Configures created Persistent Volume Claims and how they bind to Persistent Volumes"

  name:
    __metadata:
      label: "The prefix of PVC."
      description: "The prefix of the created Persistent Volume Claims. The defaults to data"
      type: "string"
      required: false

  selector:
    # label - label that the PV should have to be boundable to created PVCs
    label:
      __metadata:
        label: "Label of Persistent Volume"
        description: "If useDynamicProvisioning is disabled, this specifies labels that needs to have the Persistent Volumes to be used. Defaults to null"
        type: "string"
        required: false
            # value - value of the label that the PV should have to be boundable to created PVCs
    value:
      __metadata:
        label: "Value of Persistent Volume label"
        description: "Specifies value assigned to the label that needs to have the Persistent Volumes to be used. Defaults to null"
        type: "string"
        required: false

rbac:
  __metadata:
    label: "Automatic RBAC Configuration"
    description: "Specifies whether RBAC resources (Role and RoleBinding) should be created"
  create:
    __metadata:
      label: "Enable Chart to create Role and Binding"
      description: "Enables chart to create its own role and binding. Defaults to true."
      type: "boolean"
      required: true

serviceAccount:
  __metadata:
    label: "ServiceAccount configuration"
    description: "Configure ServiceAccount used by the chart"
  create:
    __metadata:
      label: "Enable Chart to create serviceAccount."
      description: "Enables chart to create its own serviceaccount. Defaults to true."
      type: "boolean"
      required: true
  name:
    __metadata:
      label: "Name of the service account"
      description: "Name of the service account to use (and create if specified)"
      required: false
      type: "string"

livenessProbe:
  __metadata:
    label: "Liveness probe configuration"
    description: "Liveness probe configuration for keeper pods"
  initialDelaySeconds:
    __metadata:
      name: "initialDelaySeconds"
      label: "Liveness probe initial delay seconds"
      description: "Number of seconds after the container has started before the probe is initiated."
      type: "number"
      immutable: false
      required: true
  periodSeconds:
    __metadata:
      name: "periodSeconds"
      label: "Liveness probe period seconds"
      description: "How often (in seconds) to perform the probe."
      type: "number"
      immutable: false
      required: true
  timeoutSeconds:
    __metadata:
      name: "timeoutSeconds"
      label: "Liveness probe timeout seconds"
      description: "Number of seconds after which the probe times out."
      type: "number"
      immutable: false
      required: true
  successThreshold:
    __metadata:
      name: "successThreshold"
      label: "Liveness probe success threshold"
      description: "Minimum consecutive successes for the probe to be considered successful after having failed."
      type: "number"
      immutable: false
      required: true
  failureThreshold:
    __metadata:
      name: "failureThreshold"
      label: "Liveness probe failure threshold"
      description: "Number of failures to accept before giving up and marking the pod as Unready."
      type: "number"
      immutable: false
      required: true

readinessProbe:
  __metadata:
    label: "Readiness probe configuration"
    description: "Readiness probe configuration for keeper pods"
  initialDelaySeconds:
    __metadata:
      name: "initialDelaySeconds"
      label: "Readiness probe initial delay seconds"
      description: "Number of seconds after the container has started before the probe is initiated."
      type: "number"
      immutable: false
      required: true
  periodSeconds:
    __metadata:
      name: "periodSeconds"
      label: "Readiness probe period seconds"
      description: "How often (in seconds) to perform the probe."
      type: "number"
      immutable: false
      required: true
  timeoutSeconds:
    __metadata:
      name: "timeoutSeconds"
      label: "Readiness probe timeout seconds"
      description: "Number of seconds after which the probe times out."
      type: "number"
      immutable: false
      required: true
  successThreshold:
    __metadata:
      name: "successThreshold"
      label: "Readiness probe success threshold"
      description: "Minimum consecutive successes for the probe to be considered successful after having failed."
      type: "number"
      immutable: false
      required: true
  failureThreshold:
    __metadata:
      name: "failureThreshold"
      label: "Readiness probe failure threshold"
      description: "Number of failures to accept before giving up and restarting the."
      type: "number"
      immutable: false
      required: true

metering:
  __metadata:
    label: "Metering details"
    description: "Annotations to be used metering service (if present)."
    hidden: true
    type: "string"
    multiline: true
    required: false
