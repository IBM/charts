{{- include "sch.config.init" (list . "sch.chart.config.values") -}}
{{- $oauthDbPort := .Values.oauth.database.port -}}
{{- $tsDbPort := .Values.teamserver.database.port -}}
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: ums-database
  labels:
{{ include "sch.metadata.labels.standard" (list . "ums") | indent 4 }}
spec:
  podSelector: 
    matchLabels:
{{ include "sch.metadata.labels.standard" (list . "ums")  | indent 6 }}
  policyTypes:
  - Egress
  egress:
  - to:
    ports:
{{- if $oauthDbPort }}
    - protocol: TCP
      port: {{ $oauthDbPort }}
{{- end }}
{{- if $tsDbPort }}
    - protocol: TCP
      port: {{ $tsDbPort }}
{{- end }}